/***********************************************
* koGrid JavaScript Library
* Authors: https://github.com/ericmbarnard/koGrid/blob/master/README.md
* License: MIT (http://www.opensource.org/licenses/mit-license.php)
* Compiled At: 2014-01-22 17:11:51
***********************************************/
!function(a){"use strict";a.kg||(a.kg={}),a.kg.numberOfGrids=0,a.kg.eventStorage={};var b="__kg_selected__",c=8,d=6,e="asc",f="desc",g="_kg_field_",h="_kg_depth_",i="_kg_hidden_",j="_kg_column_",k=/<.+>/;a.kg.moveSelectionHandler=function(b,d){if(a.kg.utils.isNullOrUndefined(b)||a.kg.utils.isNullOrUndefined(b.config.selectedItems))return!0;var e=d.which||d.keyCode,f=38===e?-1:40===e?1:null;if(!f)return!0;var g=b.renderedRows(),h=g.indexOf(b.selectionService.lastClickedRow)+f;return 0>h||h>=g.length?!0:(b.selectionService.ChangeSelection(g[h],d),h>g.length-c?b.$viewport.scrollTop(b.$viewport.scrollTop()+b.config.rowHeight*c):c>h&&b.$viewport.scrollTop(b.$viewport.scrollTop()-b.config.rowHeight*c),!1)},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),Array.prototype.filter||(Array.prototype.filter=function(a){var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments[1],f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),a.kg.utils={visualLength:function(a){var b=document.getElementById("testDataLength");return b||(b=document.createElement("SPAN"),b.id="testDataLength",b.style.visibility="hidden",document.body.appendChild(b)),$(b).css("font",$(a).css("font")),b.innerHTML=$(a).text(),b.offsetWidth},forIn:function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(a[c],c)},evalProperty:function(a,b){var c=ko.utils.unwrapObservable(a),d=b.split("."),e=0,f=ko.utils.unwrapObservable(c[d[e]]),g=d.length;for(e++;f&&g>e;)f=ko.utils.unwrapObservable(f[d[e]]),e++;return f},endsWith:function(a,b){return a&&b&&"string"==typeof a?-1!==a.indexOf(b,a.length-b.length):!1},isNullOrUndefined:function(a){return void 0===a||null===a?!0:!1},getElementsByClassName:function(a){for(var b=[],c=new RegExp("\\b"+a+"\\b"),d=document.getElementsByTagName("*"),e=0;e<d.length;e++){var f=d[e].className;c.test(f)&&b.push(d[e])}return b},getTemplatePromise:function(a){return $.ajax(a)},newId:function(){var a=(new Date).getTime();return function(){return a+=1}}(),ieVersion:function(){for(var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:void 0}()},$.extend(a.kg.utils,{isIe6:function(){return 6===a.kg.utils.ieVersion}(),isIe7:function(){return 7===a.kg.utils.ieVersion}(),isIe:function(){return void 0!==a.kg.utils.ieVersion}()}),a.kg.defaultGridTemplate=function(){return'<div data-bind="css: {\'ui-widget\': jqueryUITheme, \'kgNoSelect\' : disableTextSelection}"><div class="kgTopPanel" data-bind="css: {\'ui-widget-header\':jqueryUITheme, \'ui-corner-top\': jqueryUITheme}, style: $data.topPanelStyle"><div class="kgGroupPanel" data-bind="visible: $data.showGroupPanel, style: headerStyle"><div class="kgGroupPanelDescription" data-bind="visible: configGroups().length == 0">Drag a column header here and drop it to group by that column</div><ul data-bind="visible: configGroups().length > 0, foreach: configGroups" class="kgGroupList"><li class="kgGroupItem"><span class="kgGroupElement"><div class="kgGroupName"><span data-bind="text: displayName"></span><span data-bind="click: function(data) { $root.removeGroup($index()) }" class="kgRemoveGroup">x</span></div><span data-bind="visible: $index() < ($root.configGroups().length - 1)" class="kgGroupArrow"></span></span></li></ul></div><div class="kgHeaderContainer" data-bind="style: headerStyle"><div class="kgHeaderScroller" data-bind="style: headerScrollerStyle, kgHeaderRow: $data" ></div></div><div class="kgTopSummaryContainer" data-bind="visible: showTopSummary, style: topSummaryStyle"><div class="kgHeaderScroller" data-bind="style: headerScrollerStyle, kgTopSummaryRow: $data" ></div></div><div class="kgHeaderButton" data-bind="visible: ($data.showColumnMenu || $data.showFilter), click: toggleShowMenu"><div class="kgHeaderButtonArrow"></div></div><div data-bind="visible: showMenu" class="kgColMenu"><div data-bind="visible: showFilter"><input placeholder="Search Field:Value" type="text" data-bind="value: filterText, valueUpdate: \'afterkeydown\'"/></div><div data-bind="visible: showColumnMenu"><span class="kgMenuText">Choose Columns:</span><!--<ul class="kgColList" data-bind="foreach: nonAggColumns">--><ul class="kgColList" data-bind="foreach: groupableByCol"><li class="kgColListItem"><label style="position: relative;"><input type="checkbox" class="kgColListCheckbox" data-bind="checked: visible"/><span data-bind="text: displayName, click: toggleVisible"></span><a title="Group By" data-bind="attr: {\'class\': groupedByClass }, visible: (field != \'✔\'), click: $parent.groupBy"></a><span class="kgGroupingNumber" data-bind="visible: groupIndex() > 0, text: groupIndex"></span></label></li></ul></div></div></div><div class="kgViewport" data-bind="css: {\'ui-widget-content\': jqueryUITheme}, style: viewportStyle"><div class="kgCanvas" data-bind="style: canvasStyle"><div data-bind="foreach: renderedRows" style="position: absolute;"><div data-bind="style: { \'top\': offsetTop, \'height\': $parent.rowHeight + \'px\' }, click: toggleSelected, css: {\'selected\': selected, \'even\': isEven , \'odd\': isOdd, \'ui-state-default\': $parent.jqueryUITheme && isOdd, \'ui-state-active\':$parent.jqueryUITheme && isEven}, kgRow: $data" class="kgRow"></div></div></div></div><div class="kgFooterPanel" data-bind="kgFooterRow: $data, style: footerStyle"></div></div>'},a.kg.defaultRowTemplate=function(){return"<div data-bind=\"style: { cursor : canSelectRows ? 'pointer' : 'default' }, foreach: $grid.visibleColumns, css: { 'ui-widget-content': $grid.jqueryUITheme }\"><div data-bind=\"attr: { 'class': cellClass() + ' kgCell col' + $index() }, kgCell: $data\"></div></div>"},a.kg.defaultCellTemplate=function(){return"<div data-bind=\"attr: { 'class': 'kgCellText colt' + $index()}, html: $data.getProperty($parent)\"></div>"},a.kg.aggregateTemplate=function(){return'<div data-bind="click: toggleExpand, style: {\'left\': offsetLeft()}" class="kgAggregate"><span class="kgAggregateText" data-bind="html: $data.label">(<span data-bind="html: totalChildren"></span> Items)</span><div data-bind="attr: {\'class\' : aggClass }"></div></div>'},a.kg.defaultHeaderRowTemplate=function(){return"<div data-bind=\"foreach: visibleColumns\"><div data-bind=\"kgHeaderCell: $data, attr: { 'class': 'kgHeaderCell col' + $index() }\"></div></div>"},a.kg.defaultFooterRowTemplate=function(){return'<div data-bind="css: {\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}"><div class="kgTotalSelectContainer" data-bind="visible: footerVisible"><div class="kgFooterTotalItems" data-bind="css: {\'kgNoMultiSelect\': !multiSelect}" ><span class="kgLabel">Total Items: <span data-bind="text: maxRowsDisplay"></span></span><span data-bind="visible: filterText().length > 0" class="kgLabel">(Showing: <span data-bind="text: totalFilteredItemsLength"></span>)</span></div><div class="kgFooterSelectedItems" data-bind="visible: multiSelect"><span class="kgLabel">Selected Items: <span data-bind="text: selectedItemCount"></span></span></div></div><div class="kgPagerContainer" style="float: right; margin-top: 10px;" data-bind="visible: (footerVisible && enablePaging), css: {\'kgNoMultiSelect\': !multiSelect}"><div style="float:left; margin-right: 10px;" class="kgRowCountPicker"><span style="float: left; margin-top: 3px;" class="kgLabel">Page Size:</span><select style="float: left;height: 27px; width: 100px" data-bind="value: pagingOptions.pageSize, options: pagingOptions.pageSizes"></select></div><div style="float:left; margin-right: 10px; line-height:25px;" class="kgPagerControl" style="float: left; min-width: 135px;"><button class="kgPagerButton" data-bind="click: pageToFirst, disable: cantPageBackward()" title="First Page"><div class="kgPagerFirstTriangle"><div class="kgPagerFirstBar"></div></div></button><button class="kgPagerButton" data-bind="click: pageBackward, disable: cantPageBackward()" title="Previous Page"><div class="kgPagerFirstTriangle kgPagerPrevTriangle"></div></button><input class="kgPagerCurrent" type="number" style="width:50px; height: 24px; margin-top: 1px; padding: 0px 4px;" data-bind="value: pagingOptions.currentPage, valueUpdate: \'afterkeydown\'"/><button class="kgPagerButton" data-bind="click: pageForward, disable: cantPageForward()" title="Next Page"><div class="kgPagerLastTriangle kgPagerNextTriangle"></div></button><button class="kgPagerButton" data-bind="click: pageToLast, disable: cantPageForward()" title="Last Page"><div class="kgPagerLastTriangle"><div class="kgPagerLastBar"></div></div></button></div></div></div>'},a.kg.defaultHeaderCellTemplate=function(){return"<div data-bind=\"style: { cursor : sortable() ? 'pointer' : 'default' }, click: sort, css: {'kgSorted': !noSortVisible }, attr: {'class': 'kgHeaderSortColumn ' + headerClass()}\"><div data-bind=\"attr: { 'class': 'colt' + $index() + ' kgHeaderText' }, html: displayName\"></div><div class=\"kgSortButtonDown\" data-bind=\"visible: showSortButtonDown\"></div><div class=\"kgSortButtonUp\" data-bind=\"visible: showSortButtonUp\"></div><div data-bind=\"visible: resizable, click: gripClick, mouseEvents: { mouseDown: gripOnMouseDown }\" class=\"kgHeaderGrip\" ></div></div>"},ko.bindingHandlers.koGrid=function(){return{init:function(b,c,d,e,f){var g=c(),h=$(b);g.gridDim=new a.kg.Dimension({outerHeight:ko.observable(h.height()),outerWidth:ko.observable(h.width())});var i=g.groups;g.groups=[];var j=new a.kg.Grid(g),k=$(a.kg.defaultGridTemplate());return g.data.subscribe(function(){j.$$selectionPhase||(j.searchProvider.evalFilter(),j.refreshDomSizes())}),void 0!==g.selectedItems&&g.selectedItems.subscribeArrayChanged(function(a){j.$$selectionPhase||$.each(j.rowFactory.rowCache,function(b,c){return c.entity==a?(j.selectionService.setSelection(c,!0),void 0):void 0})},function(a){j.$$selectionPhase||$.each(j.rowFactory.rowCache,function(b,c){return c.entity==a?(j.selectionService.setSelection(c,!1),void 0):void 0})}),ko.isObservable(g.columnDefs)&&g.columnDefs.subscribe(function(a){j.columns([]),j.config.columnDefs=a,j.buildColumns(),j.configureColumnWidths()}),h.addClass("koGrid").addClass(j.gridId.toString()),h.append(k),j.$userViewModel=f.$data,ko.applyBindings(j,k[0]),a.kg.domUtilityService.AssignGridContainers(h,j),j.configureColumnWidths(),j.refreshDomSizes(),j.eventProvider=new a.kg.EventProvider(j),$.each(j.config.plugins,function(a,b){"function"==typeof b.onGridInit&&b.onGridInit(j)}),a.kg.domUtilityService.BuildStyles(j),i&&$.each(i,function(a,b){$.each(j.columns(),function(a,c){c.field==b&&j.groupBy(c)})}),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.kgRow=function(){return{init:function(a,b,c,d,e){var f,g=b(),h=g.$grid=e.$parent;f=g.isAggRow?h.aggregateRowTemplate:h.rowTemplate;var i=function(b){var c=$(b);g.$userViewModel=e.$parent.$userViewModel,ko.applyBindings(g,c[0]),$(a).html(c)};return f.then?f.then(function(a){i(a)}):i(f),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.kgCell=function(){return{init:function(a,b,c,d,e){var f=b(),g=function(b){var c=$(b);f.$userViewModel=e.$parent.$userViewModel,ko.applyBindings(e,c[0]),$(a).html(c)};return d.cellTemplate.then?d.cellTemplate.then(function(a){g(a)}):g(d.cellTemplate),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.kgHeaderRow=function(){return{init:function(a,b,c,d,e){e.$userViewModel=e.$data.$userViewModel;var f=function(b){var c=$(b);ko.applyBindings(e,c[0]),$(a).html(c)};return d.headerRowTemplate.then?d.headerRowTemplate.then(function(a){f(a)}):f(d.headerRowTemplate),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.kgFooterRow=function(){return{init:function(a,b,c,d,e){e.$userViewModel=e.$data.$userViewModel;var f=function(b){var c=$(b);ko.applyBindings(e,c[0]),$(a).html(c)};return d.footerRowTemplate.then?d.footerRowTemplate.then(function(a){f(a)}):f(d.footerRowTemplate),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.kgHeaderCell=function(){return{init:function(a,b,c,d,e){var f=e.extend({$grid:e.$parent,$userViewModel:e.$parent.$userViewModel}),g=function(b){var c=$(b);ko.applyBindings(f,c[0]),$(a).html(c)};return d.headerCellTemplate.then?d.headerCellTemplate.then(function(a){g(a)}):g(d.headerCellTemplate),{controlsDescendantBindings:!0}}}}(),ko.bindingHandlers.mouseEvents=function(){return{init:function(a,b){var c=b();c.mouseDown&&$(a).mousedown(c.mouseDown)}}}(),a.kg.Aggregate=function(a,b){var c=this;c.index=0,c.offsetTop=ko.observable(0),c.entity=a,c.label=ko.observable(a.gLabel),c.field=a.gField,c.depth=a.gDepth,c.parent=a.parent,c.children=a.children,c.aggChildren=a.aggChildren,c.aggIndex=a.aggIndex,c.collapsed=ko.observable(!0),c.isAggRow=!0,c.offsetLeft=ko.observable((25*a.gDepth).toString()+"px"),c.aggLabelFilter=a.aggLabelFilter,c.toggleExpand=function(){var a=c.collapsed();c.collapsed(!a),c.entity._kg_collapsed=c.collapsed(),c.notifyChildren()},c.setExpand=function(a){c.collapsed(a),c.entity._kg_collapsed=c.collapsed(),c.notifyChildren()},c.getOffsetTopInt=function(){var a=(""+c.offsetTop()).indexOf("px");return 0>a?parseInt(c.offsetTop(),10):parseInt((""+c.offsetTop()).slice(0,a),10)},c.notifyChildren=function(){$.each(c.aggChildren,function(a,b){if(b.entity[i]=c.collapsed(),c.collapsed()){var d=c.collapsed();b.setExpand(d)}}),$.each(c.children,function(a,b){b[i]=c.collapsed()}),b.rowCache=[];var a=!1;$.each(b.aggCache,function(b,d){if(a){var e=30*c.children.length,f=c.collapsed();d.offsetTop(f?d.getOffsetTopInt()-e+"px":d.getOffsetTopInt()+e+"px")}else b==c.aggIndex&&(a=!0)}),b.renderedChange()},c.aggClass=ko.computed(function(){return c.collapsed()?"kgAggArrowCollapsed":"kgAggArrowExpanded"}),c.totalChildren=ko.computed(function(){if(c.aggChildren.length>0){var a=0,b=function(c){c.aggChildren.length>0?$.each(c.aggChildren,function(a,c){b(c)}):a+=c.children.length};return b(c),a}return c.children.length}),c.getAllChildren=function(){if(c.aggChildren.length>0){var a=[],b=function(c){c.aggChildren.length>0?$.each(c.aggChildren,function(a,c){b(c)}):$.each(c.children,function(b,c){a.push(c)})};return b(c),a}return c.children},c.selected=ko.observable(!1),c.isEven=ko.observable(!1),c.isOdd=ko.observable(!1),c.toggleSelected=function(){return!0}},a.kg.Column=function(b,c){var d=this,g=b.colDef,h=500,i=0,j=null;d.config=b,d.eventTaget=void 0,d.width=g.width,d.groupIndex=ko.observable(b.colDef.groupIndex||0),d.isGroupedBy=ko.observable(!1),d.groupedByClass=ko.computed(function(){return d.isGroupedBy()?"kgGroupedByIcon":"kgGroupIcon"}),d.sortable=ko.observable(!1),d.resizable=ko.observable(!1),d.minWidth=g.minWidth?g.minWidth:50,d.maxWidth=g.maxWidth?g.maxWidth:9e3,d.headerRowHeight=b.headerRowHeight,d.displayName=ko.observable(g.displayName||g.field),d.summaryFunction=g.summaryFunction,d.index=b.index,d.isAggCol=b.isAggCol,d.isGroupable=g.isGroupable,d.cellClass=ko.observable(g.cellClass||""),d.cellFilter=g.cellFilter||g.cellFormatter,d.field=g.field,d.aggLabelFilter=g.cellFilter||g.cellFormatter||g.aggLabelFilter||g.aggLabelFormatter,d._visible=ko.observable(a.kg.utils.isNullOrUndefined(g.visible)||g.visible),d.visible=ko.computed({read:function(){return c&&c.config.showGroupedColumns===!1&&d.isGroupedBy()?!1:d._visible()},write:function(a){d.toggleVisible(a)}}),b.enableSort&&d.sortable(a.kg.utils.isNullOrUndefined(g.sortable)||g.sortable),b.enableResize&&d.resizable(a.kg.utils.isNullOrUndefined(g.resizable)||g.resizable),d.sortDirection=ko.observable(void 0),d.sortingAlgorithm=g.sortFn,d.headerClass=ko.observable(g.headerClass),d.topSummaryClass=ko.observable(g.topSummaryClass),d.headerCellTemplate=g.headerCellTemplate||a.kg.defaultHeaderCellTemplate(),d.topSummaryCellTemplate=g.topSummaryCellTemplate||a.kg.defaultTopSummaryCellTemplate(),d.cellTemplate=g.cellTemplate||a.kg.defaultCellTemplate(),d.aggregateSummaryCellTemplate=g.aggregateSummaryCellTemplate||a.kg.defaultAggregateSummaryCellTemplate(),g.cellTemplate&&!k.test(g.cellTemplate)&&(d.cellTemplate=a.kg.utils.getTemplatePromise(g.cellTemplate)),g.topSummaryCellTemplate&&!k.test(g.topSummaryCellTemplate)&&(d.topSummaryCellTemplate=a.kg.utils.getTemplatePromise(g.topSummaryCellTemplate)),g.headerCellTemplate&&!k.test(g.headerCellTemplate)&&(d.headerCellTemplate=a.kg.utils.getTemplatePromise(g.headerCellTemplate)),g.aggregateSummaryCellTemplate&&!k.test(g.aggregateSummaryCellTemplate)&&(d.aggregateSummaryCellTemplate=a.kg.utils.getTemplatePromise(g.aggregateSummaryCellTemplate)),d.getProperty=function(a){var b;return b=d.cellFilter?d.cellFilter(a.getProperty(d.field)):a.getProperty(d.field)},d.toggleVisible=function(b){var e;e=a.kg.utils.isNullOrUndefined(b)||"object"==typeof b?!d._visible():b,d._visible(e),a.kg.domUtilityService.BuildStyles(c)},d.showSortButtonUp=ko.computed(function(){return d.sortable?d.sortDirection()===f:d.sortable}),d.showSortButtonDown=ko.computed(function(){return d.sortable?d.sortDirection()===e:d.sortable}),d.noSortVisible=ko.computed(function(){return!d.sortDirection()}),d.sort=function(){if(!d.sortable())return!0;var a=d.sortDirection()===e?f:e;return d.sortDirection(a),b.sortCallback(d,a),!1},d.gripClick=function(a,c){c.stopPropagation(),i++,1===i?j=setTimeout(function(){i=0},h):(clearTimeout(j),b.resizeOnDataCallback(d),i=0)},d.gripOnMouseDown=function(b){return b.stopPropagation(),b.ctrlKey?(d.toggleVisible(),a.kg.domUtilityService.BuildStyles(c),c.config.columnsChanged(c.columns.peek()),!0):(d.eventTaget=b.target.parentElement,d.eventTaget.style.cursor="col-resize",d.startMousePosition=b.clientX,d.origWidth=d.width,$(document).on("mousemove.kg-col-resize",d.onMouseMove),$(document).on("mouseup.kg-col-resize",d.gripOnMouseUp),!1)},d.onMouseMove=function(b){b.stopPropagation();var e=b.clientX-d.startMousePosition,f=e+d.origWidth;return d.width=f<d.minWidth?d.minWidth:f>d.maxWidth?d.maxWidth:f,a.kg.domUtilityService.BuildStyles(c),!1},d.gripOnMouseUp=function(a){return a.stopPropagation(),$(document).off("mousemove.kg-col-resize"),$(document).off("mouseup.kg-col-resize"),d.eventTaget.style.cursor=d.sortable()?"pointer":"default",d.eventTaget=void 0,c.config.columnsChanged(c.columns.peek()),!1}},a.kg.Dimension=function(a){this.outerHeight=null,this.outerWidth=null,$.extend(this,a)},a.kg.EventProvider=function(b){var c=this;c.colToMove=void 0,c.groupToMove=void 0,c.assignEvents=function(){b.config.enableColumnDragAndDrop&&(b.config.jqueryUIDraggable?(b.$groupPanel.droppable({addClasses:!1,drop:function(a){c.onGroupDrop(a)}}),$(document).ready(c.setDraggables)):(b.$groupPanel.on("mousedown",c.onGroupMouseDown).on("dragover",c.dragOver).on("drop",c.onGroupDrop),b.$headerScroller.on("mousedown",c.onHeaderMouseDown).on("dragover",c.dragOver).on("drop",c.onHeaderDrop),b.config.enableRowReordering&&b.$viewport.on("mousedown",c.onRowMouseDown).on("dragover",c.dragOver).on("drop",c.onRowDrop),c.setDraggables()),b.visibleColumns.subscribe(c.setDraggables))},c.dragOver=function(a){a.preventDefault()},c.setDraggables=function(){b.config.jqueryUIDraggable?b.$root.find(".kgHeaderSortColumn").draggable({helper:"clone",appendTo:"body",stack:"div",addClasses:!1,start:function(a){c.onHeaderMouseDown(a)}}).droppable({drop:function(a){c.onHeaderDrop(a)}}):(b.$root.find(".kgHeaderSortColumn").attr("draggable","true"),-1!=navigator.userAgent.indexOf("MSIE")&&b.$root.find(".kgHeaderSortColumn").bind("selectstart",function(){return this.dragDrop(),!1}))},c.onGroupMouseDown=function(a){var d=$(a.target);if("kgRemoveGroup"!=d[0].className){var e=ko.dataFor(d[0]);e&&(b.config.jqueryUIDraggable||d.attr("draggable","true"),c.groupToMove={header:d,groupName:e,index:e.groupIndex()-1})}else c.groupToMove=void 0},c.onGroupDrop=function(a){var d,e;c.groupToMove?(d=$(a.target).closest(".kgGroupElement"),"kgGroupPanel"==d.context.className?(b.configGroups.splice(c.groupToMove.index,1),b.configGroups.push(c.groupToMove.groupName)):(e=ko.dataFor(d[0]),e&&c.groupToMove.index!=e.groupIndex()&&(b.configGroups.splice(c.groupToMove.index,1),b.configGroups.splice(e.groupIndex(),0,c.groupToMove.groupName))),c.groupToMove=void 0,b.fixGroupIndexes()):(-1==b.configGroups.indexOf(c.colToMove.col)&&(d=$(a.target).closest(".kgGroupElement"),"kgGroupPanel"==d.context.className||"kgGroupPanelDescription"==d.context.className?b.groupBy(c.colToMove.col):(e=ko.dataFor(d[0]),e&&b.removeGroup(e.groupIndex()))),c.colToMove=void 0)},c.onHeaderMouseDown=function(a){var b=$(a.target).closest(".kgHeaderSortColumn");if(!b[0])return!0;var d=ko.dataFor(b[0]);return d&&(c.colToMove={header:b,col:d}),!0},c.onHeaderDrop=function(d){if(!c.colToMove)return!0;var e=$(d.target).closest(".kgHeaderSortColumn");if(!e[0])return!0;var f=ko.dataFor(e[0]);if(f){if(c.colToMove.col==f)return!0;var g=b.columns.peek();g.splice(c.colToMove.col.index,1),g.splice(f.index,0,c.colToMove.col),b.fixColumnIndexes(),b.columns(g),a.kg.domUtilityService.BuildStyles(b),c.colToMove=void 0}return!0},c.onRowMouseDown=function(b){var c=$(b.target).closest(".kgRow");if(c[0]){var d=ko.dataFor(c[0]);d&&(c.attr("draggable","true"),a.kg.eventStorage.rowToMove={targetRow:c,scope:d})}},c.onRowDrop=function(c){var d=$(c.target).closest(".kgRow"),e=ko.dataFor(d[0]);if(e){var f=a.kg.eventStorage.rowToMove;if(f.scope==e)return;var g=b.sortedData(),h=g.indexOf(f.scope.entity),i=g.indexOf(e.entity);b.sortedData.splice(h,1),b.sortedData.splice(i,0,f.scope.entity),b.searchProvider.evalFilter(),a.kg.eventStorage.rowToMove=void 0}},c.assignGridEventHandlers=function(){b.$viewport.scroll(function(a){var c=a.target.scrollLeft,d=a.target.scrollTop;b.adjustScrollLeft(c),b.adjustScrollTop(d)}),b.$viewport.off("keydown"),b.$viewport.on("keydown",function(c){return a.kg.moveSelectionHandler(b,c)}),-1===b.config.tabIndex?(b.$viewport.attr("tabIndex",a.kg.numberOfGrids),a.kg.numberOfGrids++):b.$viewport.attr("tabIndex",b.config.tabIndex),$(a).resize(function(){a.kg.domUtilityService.UpdateGridLayout(b),b.config.maintainColumnRatios&&b.configureColumnWidths()})},c.assignGridEventHandlers(),c.assignEvents()},a.kg.RowFactory=function(d){var e=this;e.rowCache=[],e.aggCache={},e.parentCache=[],e.dataChanged=!0,e.parsedData=[],e.rowConfig={},e.selectionService=d.selectionService,e.rowHeight=30,e.numberOfAggregates=0,e.groupedData=void 0,e.rowHeight=d.config.rowHeight,e.rowConfig={canSelectRows:d.config.canSelectRows,rowClasses:d.config.rowClasses,selectedItems:d.config.selectedItems,selectWithCheckboxOnly:d.config.selectWithCheckboxOnly,beforeSelectionChangeCallback:d.config.beforeSelectionChange,afterSelectionChangeCallback:d.config.afterSelectionChange},e.renderedRange=new a.kg.Range(0,d.minRowsToRender()+c),e.buildEntityRow=function(c,d){var f=e.rowCache[d];return f||(f=new a.kg.Row(c,e.rowConfig,e.selectionService),f.rowIndex(d+1),f.offsetTop((e.rowHeight*d).toString()+"px"),f.selected(c[b]()),e.rowCache[d]=f),f},e.buildAggregateRow=function(b,c){var d=e.aggCache[b.aggIndex];return d||(d=new a.kg.Aggregate(b,e),e.aggCache[b.aggIndex]=d),d.index=c+1,d.offsetTop((e.rowHeight*c).toString()+"px"),d},e.UpdateViewableRange=function(a){e.renderedRange=a,e.renderedChange()},e.filteredDataChanged=function(){d.lateBoundColumns&&d.filteredData().length>1&&(d.config.columnDefs=void 0,d.buildColumns(),d.lateBoundColumns=!1),e.dataChanged=!0,e.rowCache=[],d.config.groups.length>0&&e.getGrouping(d.config.groups),e.UpdateViewableRange(e.renderedRange)},e.renderedChange=function(){if(!e.groupedData||d.config.groups.length<1)return e.renderedChangeNoGroups(),d.refreshDomSizes(),void 0;e.parentCache=[];var a=[],b=e.parsedData.filter(function(a){return a[i]===!1}).slice(e.renderedRange.topRow,e.renderedRange.bottomRow);$.each(b,function(b,c){var d;d=c.isAggRow?e.buildAggregateRow(c,e.renderedRange.topRow+b):e.buildEntityRow(c,e.renderedRange.topRow+b),a.push(d)}),d.setRenderedRows(a),d.refreshDomSizes()},e.renderedChangeNoGroups=function(){var a=[],b=d.filteredData.slice(e.renderedRange.topRow,e.renderedRange.bottomRow);$.each(b,function(b,c){var d=e.buildEntityRow(c,e.renderedRange.topRow+b);a.push(d)}),d.setRenderedRows(a)},e.parseGroupData=function(a){if(a.values)$.each(a.values,function(a,b){e.parentCache[e.parentCache.length-1].children.push(b),e.parentCache[e.parentCache.length-1].collapsed(!0),e.parsedData.push(b)});else for(var b in a)if(b!=g&&b!=h&&b!=j&&a.hasOwnProperty(b)){var c=e.buildAggregateRow({gField:a[g],gLabel:b,gDepth:a[h],isAggRow:!0,_kg_hidden_:!1,children:[],aggChildren:[],aggIndex:e.numberOfAggregates,aggLabelFilter:a[j].aggLabelFilter},0);c.collapsed(c.entity._kg_collapsed),e.numberOfAggregates++,c.parent=e.parentCache[c.depth-1],c.parent&&(c._kg_hidden_=c.parent.collapsed(),c.parent.aggChildren.push(c)),e.parsedData.push(c.entity),e.parentCache[c.depth]=c,e.parseGroupData(a[b])}},e.getGrouping=function(b){e.aggCache=[],e.rowCache=[],e.numberOfAggregates=0,e.groupedData={};var c=d.filteredData(),f=b.length,k=d.columns();k.length&&k.length&&($.each(c,function(c,l){l[i]=!0;var m=e.groupedData;$.each(b,function(b,c){!k[b].isAggCol&&f>=b&&(d.columns.splice(l.gDepth,0,new a.kg.Column({colDef:{field:"",width:25,sortable:!1,resizable:!1,headerCellTemplate:'<div class="kgAggHeader"></div>',topSummaryCellTemplate:'<div class="kgAggTopSummary"></div>',isGroupable:!1},isAggCol:!0,index:l.gDepth,headerRowHeight:d.config.headerRowHeight})),a.kg.domUtilityService.BuildStyles(d));var e=k.filter(function(a){return a.field==c})[0],i=a.kg.utils.evalProperty(l,c);e.cellFilter&&(i=e.cellFilter(i)),i=i?i.toString():"null",m[i]||(m[i]={}),m[g]||(m[g]=c),m[h]||(m[h]=b),m[j]||(m[j]=e),m=m[i]}),m.values||(m.values=[]),m.values.push(l)}),d.fixColumnIndexes(),e.parsedData.length=0,e.parseGroupData(e.groupedData),d.configureColumnWidths())},d.config.groups.length>0&&d.filteredData().length>0&&e.getGrouping(d.config.groups)},a.kg.Defaults={rowHeight:30,columnWidth:100,headerRowHeight:30,footerRowHeight:55,footerVisible:!0,displayFooter:void 0,canSelectRows:!0,selectAllState:ko.observable(!1),data:ko.observableArray([]),columnDefs:void 0,selectedItems:ko.observableArray([]),displaySelectionCheckbox:!0,selectWithCheckboxOnly:!1,useExternalSorting:!1,sortInfo:ko.observable(void 0),multiSelect:!0,tabIndex:-1,enableColumnResize:!0,enableColumnDragAndDrop:!0,enableSorting:!0,maintainColumnRatios:void 0,beforeSelectionChange:function(){return!0},afterSelectionChange:function(){return!0},columnsChanged:function(){},rowTemplate:void 0,headerRowTemplate:void 0,footerRowTemplate:void 0,topSummaryRowTemplate:void 0,aggregateRowTemplate:void 0,jqueryUITheme:!1,jqueryUIDraggable:!1,plugins:[],keepLastSelected:!0,groups:[],showGroupPanel:!1,showTopSummary:!1,showAggregateSummary:!1,enableRowReordering:!1,showColumnMenu:!0,showFilter:!0,searchColumn:void 0,disableTextSelection:!0,filterOptions:{filterText:ko.observable(""),useExternalFilter:!1},enablePaging:!1,pagingOptions:{pageSizes:ko.observableArray([250,500,1e3]),pageSize:ko.observable(250),totalServerItems:ko.observable(0),currentPage:ko.observable(1)}},a.kg.Grid=function(g){var h=this;h.maxCanvasHt=ko.observable(0),h.config=$.extend(a.kg.Defaults,g),h.config.columnDefs=ko.utils.unwrapObservable(g.columnDefs),h.config.columnDefs&&(h.config.columnDefs=h.config.columnDefs.slice(0,h.config.columnDefs.length)),h.gridId="ng"+a.kg.utils.newId(),h.$root=null,h.$groupPanel=null,h.$topPanel=null,h.$headerContainer=null,h.$topSummaryContainer=null,h.$headerScroller=null,h.$headers=null,h.$viewport=null,h.$canvas=null,h.rootDim=h.config.gridDim,h.sortInfo=ko.isObservable(h.config.sortInfo)?h.config.sortInfo:ko.observable(h.config.sortInfo),h.sortedData=h.config.data,h.lateBindColumns=!1,h.filteredData=ko.observableArray([]),h.lastSortedColumn=void 0,h.showFilter=h.config.showFilter,h.filterText=h.config.filterOptions.filterText,h.disableTextSelection=ko.observable(h.config.disableTextSelection),h.calcMaxCanvasHeight=function(){return h.configGroups().length>0?h.rowFactory.parsedData.filter(function(a){return a[i]===!1}).length*h.config.rowHeight:h.filteredData().length*h.config.rowHeight},h.elementDims={scrollW:0,scrollH:0,rowIndexCellW:25,rowSelectedCellW:25,rootMaxW:0,rootMaxH:0},h.setRenderedRows=function(a){h.renderedRows(a),h.refreshDomSizes()},h.minRowsToRender=function(){var a=h.viewportDimHeight()||1;return Math.floor(a/h.config.rowHeight)},h.refreshDomSizes=function(){h.rootDim.outerWidth(h.elementDims.rootMaxW),h.rootDim.outerHeight(h.elementDims.rootMaxH),h.maxCanvasHt(h.calcMaxCanvasHeight())},h.buildColumnDefsFromData=function(){var c=h.sortedData();if(h.config.columnDefs||(h.config.columnDefs=[]),!c||!c[0])return h.lateBoundColumns=!0,void 0;var d;d=c[0],a.kg.utils.forIn(d,function(a,c){c!=b&&h.config.columnDefs.push({field:c})})},h.buildColumns=function(){var b=h.config.columnDefs,c=[];if(b||(h.buildColumnDefsFromData(),b=h.config.columnDefs),h.config.displaySelectionCheckbox&&h.config.canSelectRows&&b.length>0&&"✔"!=b[0].field&&b.splice(0,0,{field:"✔",width:h.elementDims.rowSelectedCellW,sortable:!1,resizable:!1,headerCellTemplate:'<input class="kgSelectionHeader" type="checkbox" data-bind="visible: $grid.multiSelect, checked: $grid.allSelected"/>',topSummaryCellTemplate:'<div class="kgSelectionTopSummary"></div>',cellTemplate:'<div class="kgSelectionCell"><input class="kgSelectionCheckbox" type="checkbox" data-bind="checked: $parent.selected" /></div>'}),b.sort(function(a,b){return a.index-b.index}),b.length>0){h.configGroups([]);var d=[];$.each(b,function(b,e){var f=b,g=new a.kg.Column({colDef:e,index:f,headerRowHeight:h.config.headerRowHeight,sortCallback:h.sortData,resizeOnDataCallback:h.resizeOnData,enableResize:h.config.enableColumnResize,enableSort:h.config.enableSorting,isGroupable:h.config.isGroupable},h);c.push(g);var i=h.config.groups.indexOf(e.field);-1!=i?(i=e.groupIndex?e.groupIndex-1:i,d.splice(i,0,g),g.isGroupedBy(!0)):e.groupIndex&&(d.splice(e.groupIndex-1,0,g),g.isGroupedBy(!0))}),c.sort(function(a,b){return a.index-b.index});var e=[];$.each(c,function(a,b){var c=b.groupIndex();if(c){for(;e[c];)c++;b.groupIndex(c),e[c]=b}}),d.sort(function(a,b){return a.groupIndex()-b.groupIndex()});var f=[];$.each(d,function(a,b){f.push(b.field)}),h.config.groups=f,h.columns(c),h.configGroups(d),h.fixGroupIndexes()}},h.configureColumnWidths=function(){var b=h.config.columnDefs,c=[],d=[],e=0,f=0,g=h.columns(),i=[];g.length;for(var j=0;j<g.length;j++)""===g[j].field?f+=g[j].width:i.push(g[j]);if(h.columns().length-h.nonAggColumns().length,$.each(g,function(g,j){var k;if($.each(b,function(a,b){b.field==j.field&&(k=b)}),k=k?{width:k.width,index:g}:{width:j.width,index:g},j.visible!==!1){var l,m=!1;if(a.kg.utils.isNullOrUndefined(k.width)?k.width="*":(m=isNaN(k.width)?a.kg.utils.endsWith(k.width,"%"):!1,l=m?k.width:parseInt(k.width,10)),isNaN(l)){if(l=k.width,"auto"==l){i[g].width=i[g].minWidth;var n=i[g];return $(document).ready(function(){h.resizeOnData(n,!0)}),void 0}if(-1!=l.indexOf("*"))return e+=l.length,c.push({width:k.width,index:g}),void 0;if(m)return d.push({width:k.width,index:g}),void 0;throw'unable to parse column width, use percentage ("10%","20%", etc...) or "*" to use remaining width of grid'}f+=i[g].width=parseInt(k.width,10)}}),c.length>0){h.config.maintainColumnRatios===!1?$.noop():h.config.maintainColumnRatios=!0;var k=h.rootDim.outerWidth()-f,l=2;h.maxCanvasHt()>h.viewportDimHeight()&&(l+=a.kg.domUtilityService.ScrollW),k-=l,0>k&&(k=0);var m=Math.floor(k/e);1>m&&(m=1),$.each(c,function(a,b){var c=b.width.length,d=i[b.index];d.width=m*c,d.width<d.minWidth&&(d.width=d.minWidth),f+=g[b.index].width})}d.length>0&&(k=h.rootDim.outerWidth()-f,$.each(d,function(a,b){var c=b.width;i[b.index].width=Math.floor(k*(parseInt(c.slice(0,-1),10)/100))})),h.columns(g),a.kg.domUtilityService.BuildStyles(h)},h.columnByField=function(a){if(a){var b;return $.each(h.columns(),function(c,d){return a==d.field?(b=d,!1):void 0
}),b}},h.init=function(){h.selectionService=new a.kg.SelectionService(h),h.rowFactory=new a.kg.RowFactory(h),h.selectionService.Initialize(h.rowFactory),h.buildColumns(),h.searchProvider=new a.kg.SearchProvider(h),h.styleProvider=new a.kg.StyleProvider(h);var b=h.sortInfo.peek();if(b){var c=h.columnByField(b.column.field);c&&(c.sortDirection(b.direction===e?f:e),c.sort())}a.kg.sortService.columns=h.columns,h.configGroups.subscribe(function(a){if(a){var b=[];$.each(a,function(a,c){c&&b.push(c.field||c)}),h.config.groups=b,h.rowFactory.filteredDataChanged()}}),h.filteredData.subscribe(function(){h.$$selectionPhase||(h.maxCanvasHt(h.calcMaxCanvasHeight()),h.isSorting||h.configureColumnWidths())}),h.maxCanvasHt(h.calcMaxCanvasHeight()),h.searchProvider.evalFilter(),h.refreshDomSizes()},h.prevScrollTop=0,h.prevScrollIndex=0,h.adjustScrollTop=function(b,e){if(h.prevScrollTop!==b||e){var f=Math.floor(b/h.config.rowHeight);h.prevScrollTop<b&&f<h.prevScrollIndex+d||h.prevScrollTop>b&&f>h.prevScrollIndex-d||(h.prevScrollTop=b,h.rowFactory.UpdateViewableRange(new a.kg.Range(Math.max(0,f-c),f+h.minRowsToRender()+c)),h.prevScrollIndex=f)}},h.adjustScrollLeft=function(a){h.$headerContainer&&h.$headerContainer.scrollLeft(a),h.$topSummaryContainer&&h.$topSummaryContainer.scrollLeft(a)},h.resizeOnData=function(b){var c=b.minWidth,d=a.kg.utils.getElementsByClassName("col"+b.index);$.each(d,function(b,d){var e;if(0===b){var f=$(d).find(".kgHeaderText");e=a.kg.utils.visualLength(f)+10}else if(1==b&&h.config.showTopSummary){var g=$(d).find(".kgTopSummaryText");e=a.kg.utils.visualLength(g)+10}else{var i=$(d).find(".kgCellText");e=a.kg.utils.visualLength(i)+10}e>c&&(c=e)}),b.width=c=Math.min(b.maxWidth,c+7),a.kg.domUtilityService.BuildStyles(h)},h.sortData=function(b,c){h.isSorting=!0,h.sortInfo({column:b,direction:c}),h.clearSortingData(b),h.config.useExternalSorting?h.config.sortInfo(h.sortInfo.peek()):a.kg.sortService.Sort(h.sortInfo.peek(),h.sortedData),h.lastSortedColumn=b,h.isSorting=!1},h.clearSortingData=function(a){a?h.lastSortedColumn&&a!=h.lastSortedColumn&&h.lastSortedColumn.sortDirection(""):$.each(h.columns(),function(a,b){b.sortDirection("")})},h.fixColumnIndexes=function(){h.$$indexPhase=!0;var a=h.columns.peek();$.each(a,function(a,b){b.index=a}),h.$$indexPhase=!1},h.elementsNeedMeasuring=!0,h.columns=ko.observableArray([]),h.columns.subscribe(function(a){h.config.columnsChanged(a)}),h.renderedRows=ko.observableArray([]),h.headerRow=null,h.rowHeight=h.config.rowHeight,h.jqueryUITheme=ko.observable(h.config.jqueryUITheme),h.footer=null,h.selectedItems=h.config.selectedItems,h.multiSelect=h.config.multiSelect,h.footerVisible=a.kg.utils.isNullOrUndefined(h.config.displayFooter)?h.config.footerVisible:h.config.displayFooter,h.config.footerRowHeight=h.footerVisible?h.config.footerRowHeight:0,h.showColumnMenu=h.config.showColumnMenu,h.showMenu=ko.observable(!1),h.configGroups=ko.observableArray([]),h.enablePaging=h.config.enablePaging,h.pagingOptions=h.config.pagingOptions,h.rowTemplate=h.config.rowTemplate||a.kg.defaultRowTemplate(),h.headerRowTemplate=h.config.headerRowTemplate||a.kg.defaultHeaderRowTemplate(),h.footerRowTemplate=h.config.footerRowTemplate||a.kg.defaultFooterRowTemplate(),h.topSummaryRowTemplate=h.config.topSummaryRowTemplate||a.kg.defaultTopSummaryRowTemplate(),h.aggregateRowTemplate=h.config.aggregateRowTemplate||(h.config.showAggregateSummary?a.kg.aggregateSummaryTemplate():a.kg.aggregateTemplate()),h.config.rowTemplate&&!k.test(h.config.rowTemplate)&&(h.rowTemplate=a.kg.utils.getTemplatePromise(h.config.rowTemplate)),h.config.headerRowTemplate&&!k.test(h.config.headerRowTemplate)&&(h.headerRowTemplate=a.kg.utils.getTemplatePromise(h.config.headerRowTemplate)),h.config.footerRowTemplate&&!k.test(h.config.footerRowTemplate)&&(h.footerRowTemplate=a.kg.utils.getTemplatePromise(h.config.footerRowTemplate)),h.config.topSummaryRowTemplate&&!k.test(h.config.topSummaryRowTemplate)&&(h.topSummaryRowTemplate=a.kg.utils.getTemplatePromise(h.config.topSummaryRowTemplate)),h.config.aggregateRowTemplate&&!k.test(h.config.aggregateRowTemplate)&&(h.aggregateRowTemplate=a.kg.utils.getTemplatePromise(h.config.aggregateRowTemplate)),h.visibleColumns=ko.computed(function(){var a=h.columns();return a.filter(function(a){var b=a.visible();return b})}),h.groupableByCol=ko.computed(function(){return h.columns().filter(function(a){return a.isGroupable})}),h.nonAggColumns=ko.computed(function(){return h.columns().filter(function(a){return!a.isAggCol})}),h.aggColumns=ko.computed(function(){return h.columns().filter(function(a){return a.isAggCol})}),h.nonAggAndCheckboxVisibleColumns=ko.computed(function(){var a=h.nonAggColumns();return a.filter(function(a){var b=a.visible();return b&&"✔"!=a.field})}),h.aggregateRowColumns=ko.computed(function(){return h.nonAggAndCheckboxVisibleColumns().slice(1)}),h.anyAggregateRowColumn=ko.computed(function(){return h.nonAggAndCheckboxVisibleColumns().length>0}),h.firstRealColumnIndex=ko.computed(function(){return h.visibleColumns().length-h.nonAggAndCheckboxVisibleColumns().length}),h.toggleShowMenu=function(){h.showMenu(!h.showMenu())},h.allSelected=h.config.selectAllState,h.allSelected.subscribe(function(a){h.config.beforeSelectionChange(h.sortedData.peek(),this)&&(h.selectionService.toggleSelectAll(a),h.config.afterSelectionChange(h.selectedItems.peek(),this))}),h.totalFilteredItemsLength=ko.computed(function(){return h.filteredData().length}),h.showGroupPanel=ko.computed(function(){return h.config.showGroupPanel}),h.showTopSummary=ko.computed(function(){return h.config.showTopSummary}),h.showAggregateSummary=ko.computed(function(){return h.config.showAggregateSummary}),h.topPanelHeight=ko.observable(h.config.showGroupPanel&&h.config.showTopSummary?3*h.config.headerRowHeight:h.config.showGroupPanel||h.config.showTopSummary?2*h.config.headerRowHeight:h.config.headerRowHeight),h.viewportDimHeight=ko.computed(function(){return Math.max(0,h.rootDim.outerHeight()-h.topPanelHeight()-h.config.footerRowHeight-2)}),h.groupBy=function(b){var c=h.configGroups().indexOf(b);-1==c?(b.isGroupedBy(!0),h.configGroups.push(b),b.groupIndex(h.configGroups().length)):h.removeGroup(c),a.kg.domUtilityService.BuildStyles(h)},h.removeGroup=function(b){var c=h.columns().filter(function(a){return a.groupIndex()==b+1})[0];c.isGroupedBy(!1),c.groupIndex(0),h.columns()[b].isAggCol&&h.columns.splice(b,1),h.configGroups.splice(b,1),h.fixGroupIndexes(),0===h.configGroups().length&&h.fixColumnIndexes(),a.kg.domUtilityService.BuildStyles(h)},h.fixGroupIndexes=function(){$.each(h.configGroups(),function(a,b){b.groupIndex(a+1)})},h.totalRowWidth=function(){var a=0,b=h.visibleColumns();return $.each(b,function(b,c){a+=c.width}),a},h.headerScrollerDim=function(){var b=h.viewportDimHeight(),c=h.maxCanvasHt(),d=c>b,e=new a.kg.Dimension;return e.autoFitHeight=!0,e.outerWidth=h.totalRowWidth(),d?e.outerWidth+=h.elementDims.scrollW:c-b<=h.elementDims.scrollH&&(e.outerWidth+=h.elementDims.scrollW),e},h.jqueryUITheme=h.config.jqueryUITheme,h.maxRows=ko.observable(Math.max(h.config.pagingOptions.totalServerItems()||h.sortedData().length,1)),h.maxRowsDisplay=ko.computed(function(){return h.maxRows()}),h.multiSelect=ko.observable(h.config.canSelectRows&&h.config.multiSelect),h.selectedItemCount=ko.computed(function(){return h.selectedItems().length}),h.maxPages=ko.computed(function(){return h.maxRows(Math.max(h.config.pagingOptions.totalServerItems()||h.sortedData().length,1)),Math.ceil(h.maxRows()/h.pagingOptions.pageSize())}),h.pageForward=function(){var a=h.config.pagingOptions.currentPage();h.config.pagingOptions.currentPage(Math.min(a+1,h.maxPages()))},h.pageBackward=function(){var a=h.config.pagingOptions.currentPage();h.config.pagingOptions.currentPage(Math.max(a-1,1))},h.pageToFirst=function(){h.config.pagingOptions.currentPage(1)},h.pageToLast=function(){var a=h.maxPages();h.config.pagingOptions.currentPage(a)},h.cantPageForward=ko.computed(function(){var a=h.config.pagingOptions.currentPage(),b=h.maxPages();return a>=b}),h.cantPageBackward=ko.computed(function(){var a=h.config.pagingOptions.currentPage();return 1>=a}),h.init()},kg.Range=function(a,b){this.topRow=a,this.bottomRow=b},a.kg.Row=function(c,d,e){var f=this;f.canSelectRows=d.canSelectRows,f.rowClasses=d.rowClasses,f.selectedItems=d.selectedItems,f.entity=c,f.selectionService=e,f.selected=ko.observable(!1),f.continueSelection=function(a){f.selectionService.ChangeSelection(f,a)},f.toggleSelected=function(a,b){if(!f.canSelectRows)return!0;var c=b.target||b;return"checkbox"==c.type&&f.selected(!f.selected()),d.selectWithCheckboxOnly&&"checkbox"!=c.type?!0:f.beforeSelectionChange(f,b)?(f.continueSelection(b),f.afterSelectionChange(f,b)):!1},void 0===f.entity[b]?f.entity[b]=ko.observable(!1):f.selectionService.setSelection(f,f.entity[b]()),f.rowIndex=ko.observable(0),f.offsetTop=ko.observable("0px"),f.rowDisplayIndex=0,f.isEven=ko.computed(function(){return 0===f.rowIndex()%2?!0:!1}),f.isOdd=ko.computed(function(){return 0!==f.rowIndex()%2?!0:!1}),f.beforeSelectionChange=d.beforeSelectionChangeCallback,f.afterSelectionChange=d.afterSelectionChangeCallback,f.propertyCache={},f.getProperty=function(b){if("string"==typeof b)return f.propertyCache[b]||(f.propertyCache[b]=a.kg.utils.evalProperty(f.entity,b));if("object"==typeof b&&b.alias&&b.accessor){var c=b.alias,d=b.accessor;return f.propertyCache[c]||(f.propertyCache[c]=d(f.entity))}console.log("Field definition invalid:",b)}},a.kg.SearchProvider=function(a){var b,c=this,d=[];c.extFilter=a.config.filterOptions.useExternalFilter,c.showFilter=a.config.showFilter,c.filterText=a.config.filterOptions.filterText,c.throttle=a.config.filterOptions.filterThrottle,c.fieldMap={},c.evalFilter=function(){0===d.length?a.filteredData(a.sortedData.peek().filter(function(a){return!a._destroy})):a.filteredData(a.sortedData.peek().filter(function(b){if(b._destroy)return!1;for(var e=0,f=d.length;f>e;e++){var g=d[e];if((""===g.column||void 0===g.column)&&(g.column=a.config.searchColumn),!g.column){for(var h in b)if(b.hasOwnProperty(h)){var i=ko.utils.unwrapObservable(b[h]);if(i&&g.regex.test(i.toString()))return!0}return!1}var j=ko.utils.unwrapObservable(b[g.column])||ko.utils.unwrapObservable(b[c.fieldMap[g.columnDisplay]]);if(!j||!g.regex.test(j.toString()))return!1}return!0})),a.rowFactory.filteredDataChanged()};var e=function(a,b){try{return new RegExp(a,b)}catch(c){return new RegExp(a.replace(/(\^|\$|\(|\)|<|>|\[|\]|\{|\}|\\|\||\.|\*|\+|\?)/g,"\\$1"))}},f=function(a){d=[];var b;if(b=$.trim(a)){var c=b.split(";");$.each(c,function(a,b){var c=b.split(":");if(c.length>1){var f=$.trim(c[0]),g=$.trim(c[1]);f&&g&&d.push({column:f,columnDisplay:f.replace(/\s+/g,"").toLowerCase(),regex:e(g,"i")})}else{var h=$.trim(c[0]);h&&d.push({column:"",regex:e(h,"i")})}})}},g=ko.computed(function(){var a=c.filterText();c.extFilter||a==b||(b=a,f(a),c.evalFilter())});"number"==typeof c.throttle&&g.extend({throttle:c.throttle}),c.extFilter||a.columns.subscribe(function(a){$.each(a,function(a,b){c.fieldMap[b.displayName().toLowerCase().replace(/\s+/g,"")]=b.field})})},a.kg.SelectionService=function(a){var c=this;c.multi=a.config.multiSelect,c.selectedItems=a.config.selectedItems,c.selectedIndex=a.config.selectedIndex,c.lastClickedRow=void 0,c.ignoreSelectedItemChanges=!1,c.rowFactory={},c.Initialize=function(a){c.rowFactory=a},c.ChangeSelection=function(d,e){if(a.$$selectionPhase=!0,e&&e.shiftKey&&c.multi){if(c.lastClickedRow){var f=a.filteredData.indexOf(d.entity),g=a.filteredData.indexOf(c.lastClickedRow.entity);if(a.aggColumns().length>0&&(f=a.rowFactory.rowCache.indexOf(d),g=a.rowFactory.rowCache.indexOf(c.lastClickedRow)),f==g)return!1;g++,g>f&&(f^=g,g=f^g,f^=g);for(var h=[];f>=g;g++)h.push(c.rowFactory.rowCache[g]);return h[h.length-1].beforeSelectionChange(h,e)&&($.each(h,function(a,d){d.selected(!0),d.entity[b](!0),-1===c.selectedItems.indexOf(d.entity)&&c.selectedItems.push(d.entity)}),h[h.length-1].afterSelectionChange(h,e)),c.lastClickedRow=h[h.length-1],a.$$selectionPhase=!1,!0}}else c.multi?c.setSelection(d,!d.selected()):(c.lastClickedRow&&c.lastClickedRow!=d&&c.setSelection(c.lastClickedRow,!1),c.setSelection(d,a.config.keepLastSelected?!0:!d.selected()));return c.lastClickedRow=d,a.$$selectionPhase=!1,!0},c.setSelection=function(a,d){if(a.selected(d),a.entity[b](d),d)-1===c.selectedItems.indexOf(a.entity)&&c.selectedItems.push(a.entity);else{var e=c.selectedItems.indexOf(a.entity);e>=0&&c.selectedItems.splice(e,1)}},c.toggleSelectAll=function(d){var e=c.selectedItems();e.length&&c.selectedItems([]),$.each(a.filteredData(),function(a,c){c[b](d),d&&e.push(c)}),$.each(c.rowFactory.rowCache,function(a,b){b&&b.selected&&b.selected(d)}),c.selectedItems.valueHasMutated()}},a.kg.StyleProvider=function(b){b.canvasStyle=ko.computed(function(){return{height:b.maxCanvasHt().toString()+"px"}}),b.headerScrollerStyle=ko.computed(function(){return{height:b.config.headerRowHeight+"px"}}),b.topPanelStyle=ko.computed(function(){return{width:b.rootDim.outerWidth()+"px",height:b.topPanelHeight()+"px"}}),b.headerStyle=ko.computed(function(){return{width:Math.max(0,b.rootDim.outerWidth()-a.kg.domUtilityService.ScrollW)+"px",height:b.config.headerRowHeight+"px"}}),b.topSummaryStyle=ko.computed(function(){return{width:Math.max(0,b.rootDim.outerWidth()-a.kg.domUtilityService.ScrollW)+"px",height:b.config.headerRowHeight+"px"}}),b.viewportStyle=ko.computed(function(){return{width:b.rootDim.outerWidth()+"px",height:b.viewportDimHeight()+"px"}}),b.footerStyle=ko.computed(function(){return{width:b.rootDim.outerWidth()+"px",height:b.config.footerRowHeight+"px",display:b.config.footerRowHeight>0?"block":"none"}})},a.kg.sortService={colSortFnCache:{},dateRE:/^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/,guessSortFn:function(b){var c,d,e,f,g;if(void 0===b||null===b||""===b)return null;switch(d=typeof b){case"number":c=a.kg.sortService.sortNumber;break;case"boolean":c=a.kg.sortService.sortBool;break;default:c=void 0}return c?c:"[object Date]"===Object.prototype.toString.call(b)?a.kg.sortService.sortDate:"string"!==d?a.kg.sortService.basicSort:b.match(/^-?[£$¤]?[\d,.]+%?$/)?a.kg.sortService.sortNumberStr:(e=b.match(a.kg.sortService.dateRE),e?(f=parseInt(e[1],10),g=parseInt(e[2],10),f>12?a.kg.sortService.sortDDMMStr:g>12?a.kg.sortService.sortMMDDStr:a.kg.sortService.sortMMDDStr):a.kg.sortService.sortAlpha)},basicSort:function(a,b){return a==b?0:b>a?-1:1},sortNumber:function(a,b){return a-b},sortNumberStr:function(a,b){var c,d,e=!1,f=!1;return c=parseFloat(a.replace(/[^0-9.-]/g,"")),isNaN(c)&&(e=!0),d=parseFloat(b.replace(/[^0-9.-]/g,"")),isNaN(d)&&(f=!0),e&&f?0:e?1:f?-1:c-d},sortAlpha:function(a,b){return a||b?a?b?String(a).localeCompare(b):1:-1:0},sortBool:function(a,b){return a&&b?0:a||b?a?1:-1:0},sortDate:function(a,b){var c=a.getTime(),d=b.getTime();return c==d?0:d>c?-1:1},sortDDMMStr:function(b,c){var d,e,f,g,h,i;return f=b.match(a.kg.sortService.dateRE),i=f[3],g=f[2],h=f[1],1==g.length&&(g="0"+g),1==h.length&&(h="0"+h),d=i+g+h,f=c.match(a.kg.sortService.dateRE),i=f[3],g=f[2],h=f[1],1==g.length&&(g="0"+g),1==h.length&&(h="0"+h),e=i+g+h,d==e?0:e>d?-1:1},sortMMDDStr:function(b,c){var d,e,f,g,h,i;return f=b.match(a.kg.sortService.dateRE),i=f[3],h=f[2],g=f[1],1==g.length&&(g="0"+g),1==h.length&&(h="0"+h),d=i+g+h,f=c.match(a.kg.sortService.dateRE),i=f[3],h=f[2],g=f[1],1==g.length&&(g="0"+g),1==h.length&&(h="0"+h),e=i+g+h,d==e?0:e>d?-1:1},sortData:function(b,c){var d=b();if(d&&c){var f,g,h=c.column,i=c.direction;if(a.kg.sortService.colSortFnCache[h.field])f=a.kg.sortService.colSortFnCache[h.field];else if(void 0!==h.sortingAlgorithm)f=h.sortingAlgorithm,a.kg.sortService.colSortFnCache[h.field]=h.sortingAlgorithm;else{if(g=d[0],!g)return;f=kg.sortService.guessSortFn(g[h.field]),f?a.kg.sortService.colSortFnCache[h.field]=f:f=a.kg.sortService.sortAlpha}d.sort(function(b,c){var d=a.kg.utils.evalProperty(b,h.field),g=a.kg.utils.evalProperty(c,h.field);return g||d?d||void 0!==d&&null!==d?g||void 0!==g&&null!==g?i===e?f(d,g):0-f(d,g):-1:1:0}),b(d)}},Sort:function(b,c){a.kg.sortService.isSorting||(a.kg.sortService.isSorting=!0,a.kg.sortService.sortData(c,b),a.kg.sortService.isSorting=!1)}};var l=function(){var b=$("<div></div>");b.appendTo("body"),b.height(100).width(100).css("position","absolute").css("overflow","scroll"),b.append('<div style="height: 400px; width: 400px;"></div>'),a.kg.domUtilityService.ScrollH=b.height()-b[0].clientHeight,a.kg.domUtilityService.ScrollW=b.width()-b[0].clientWidth,b.empty(),b.attr("style",""),b.append('<span style="font-family: Verdana, Helvetica, Sans-Serif; font-size: 14px;"><strong>M</strong></span>'),a.kg.domUtilityService.LetterW=b.children().first().width(),b.remove()};a.kg.domUtilityService={AssignGridContainers:function(b,c){c.$root=$(b),c.$topPanel=c.$root.find(".kgTopPanel"),c.$groupPanel=c.$root.find(".kgGroupPanel"),c.$headerContainer=c.$topPanel.find(".kgHeaderContainer"),c.$topSummaryContainer=c.$topPanel.find(".kgTopSummaryContainer"),c.$headerScroller=c.$topPanel.find(".kgHeaderScroller"),c.$headers=c.$headerScroller.children(),c.$viewport=c.$root.find(".kgViewport"),c.$canvas=c.$viewport.find(".kgCanvas"),c.$footerPanel=c.$root.find(".ngFooterPanel"),a.kg.domUtilityService.UpdateGridLayout(c)},UpdateGridLayout:function(a){var b=a.$viewport.scrollTop();a.elementDims.rootMaxW=a.$root.width(),a.elementDims.rootMaxH=a.$root.height(),a.refreshDomSizes(),a.adjustScrollTop(b,!0)},BuildStyles:function(b){var c,d=b.config.rowHeight,e=b.$styleSheet,f=b.gridId,g=b.visibleColumns(),h=0;e||(e=$("#"+f),e[0]||(e=$("<style id='"+f+"' type='text/css' rel='stylesheet' />"),e.appendTo("body"))),e.empty();var i=b.totalRowWidth();if(c="."+f+" .kgCanvas { width: "+i+"px; }"+"."+f+" .kgRow { width: "+i+"px; }"+"."+f+" .kgCell { height: "+d+"px; }"+"."+f+" .kgCanvas { width: "+i+"px; }"+"."+f+" .kgHeaderCell { top: 0; bottom: 0; }"+"."+f+" .kgHeaderScroller { width: "+(i+a.kg.domUtilityService.scrollH+2)+"px}",$.each(g,function(a,b){c+="."+f+" .col"+a+" { width: "+b.width+"px; left: "+h+"px; right: "+(i-h-b.width)+"px; height: "+d+"px }"+"."+f+" .colt"+a+" { width: "+b.width+"px; }",h+=b.width}),b.config.showAggregateSummary)for(var j=b.visibleColumns().length-b.nonAggAndCheckboxVisibleColumns().length,k=b.nonAggAndCheckboxVisibleColumns()[0],l=0;j>l;l++)c+="."+f+" .aggTitleCol"+l+" {width: "+(k.width+25*(j-l-1))+"px;}";a.kg.utils.isIe?e[0].styleSheet.cssText=c:e.append(document.createTextNode(c)),b.$styleSheet=e},ScrollH:17,ScrollW:17,LetterW:10},l()}(window);