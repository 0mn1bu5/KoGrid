/***********************************************
* koGrid JavaScript Library
* Authors: https://github.com/ericmbarnard/koGrid/blob/master/README.md
* License: MIT (http://www.opensource.org/licenses/mit-license.php)
* Compiled At: 12/19/2012 10:15:47
***********************************************/
(function (n) { "use strict"; var l; n.kg || (n.kg = {}), n.kg.numberOfGrids = 0, n.kg.eventStorage = {}; var t = "__kg_selected__", r = 8, h = 6, f = "asc", c = "desc", e = "_kg_field_", o = "_kg_depth_", u = "_kg_hidden_", s = "_kg_column_", i = /<.+>/; n.kg.moveSelectionHandler = function (t, i) { var e, o, f, u; return n.kg.utils.isNullOrUndefined(t) || n.kg.utils.isNullOrUndefined(t.config.selectedItems) ? !0 : (e = i.which || i.keyCode, o = e === 38 ? -1 : e === 40 ? 1 : null, !o) ? !0 : (f = t.renderedRows(), u = f.indexOf(t.selectionService.lastClickedRow) + o, u < 0 || u >= f.length) ? !0 : (t.selectionService.ChangeSelection(f[u], i), u > f.length - r ? t.$viewport.scrollTop(t.$viewport.scrollTop() + t.config.rowHeight * r) : u < r && t.$viewport.scrollTop(t.$viewport.scrollTop() - t.config.rowHeight * r), !1) }, String.prototype.trim || (String.prototype.trim = function () { return this.replace(/^\s+|\s+$/g, "") }), Array.prototype.indexOf || (Array.prototype.indexOf = function (n) { var i = this.length >>> 0, t = Number(arguments[1]) || 0; for (t = t < 0 ? Math.ceil(t) : Math.floor(t), t < 0 && (t += i) ; t < i; t++) if (t in this && this[t] === n) return t; return -1 }), Array.prototype.filter || (Array.prototype.filter = function (n) { var i = Object(this), e = i.length >>> 0, r, f, t, u; if (typeof n != "function") throw new TypeError; for (r = [], f = arguments[1], t = 0; t < e; t++) t in i && (u = i[t], n.call(f, u, t, i) && r.push(u)); return r }), n.kg.utils = { visualLength: function (n) { var t = document.getElementById("testDataLength"); return t || (t = document.createElement("SPAN"), t.id = "testDataLength", t.style.visibility = "hidden", document.body.appendChild(t)), $(t).css("font", $(n).css("font")), t.innerHTML = $(n).text(), t.offsetWidth }, forIn: function (n, t) { for (var i in n) n.hasOwnProperty(i) && t(n[i], i) }, evalProperty: function (n, t) { var f = ko.utils.unwrapObservable(n), u = t.split("."), i = 0, r = ko.utils.unwrapObservable(f[u[i]]), e = u.length; for (i++; r && i < e;) r = ko.utils.unwrapObservable(r[u[i]]), i++; return r }, endsWith: function (n, t) { return !n || !t || typeof n != "string" ? !1 : n.indexOf(t, n.length - t.length) !== -1 }, isNullOrUndefined: function (n) { return n === undefined || n === null ? !0 : !1 }, getElementsByClassName: function (n) { for (var r = [], f = new RegExp("\\b" + n + "\\b"), i = document.getElementsByTagName("*"), u, t = 0; t < i.length; t++) u = i[t].className, f.test(u) && r.push(i[t]); return r }, getTemplatePromise: function (n) { return $.ajax(n) }, newId: function () { var n = (new Date).getTime(); return function () { return n += 1 } }(), ieVersion: function () { for (var n = 3, t = document.createElement("div"), i = t.getElementsByTagName("i") ; t.innerHTML = "<!--[if gt IE " + ++n + "]><i><\/i><![endif]-->", i[0];); return n > 4 ? n : undefined }() }, $.extend(n.kg.utils, { isIe6: function () { return n.kg.utils.ieVersion === 6 }(), isIe7: function () { return n.kg.utils.ieVersion === 7 }(), isIe: function () { return n.kg.utils.ieVersion !== undefined }() }), n.kg.defaultGridTemplate = function () { return '<div data-bind="css: {\'ui-widget\': jqueryUITheme, \'kgNoSelect\' : disableTextSelection}"><div class="kgTopPanel" data-bind="css: {\'ui-widget-header\':jqueryUITheme, \'ui-corner-top\': jqueryUITheme}, style: $data.topPanelStyle"><div class="kgGroupPanel" data-bind="visible: $data.showGroupPanel, style: headerStyle"><div class="kgGroupPanelDescription" data-bind="visible: configGroups().length == 0">Drag a column header here and drop it to group by that column<\/div><ul data-bind="visible: configGroups().length > 0, foreach: configGroups" class="kgGroupList"><li class="kgGroupItem"><span class="kgGroupElement"><div class="kgGroupName"><span data-bind="text: displayName"><\/span><span data-bind="click: function(data) { $root.removeGroup($index()) }" class="kgRemoveGroup">x<\/span><\/div><span data-bind="visible: $index() < ($root.configGroups().length - 1)" class="kgGroupArrow"><\/span><\/span><\/li><\/ul><\/div><div class="kgHeaderContainer" data-bind="style: headerStyle"><div class="kgHeaderScroller" data-bind="style: headerScrollerStyle, kgHeaderRow: $data" ><\/div><\/div>  <div class="kgTopSummaryContainer" data-bind="visible: showTopSummary, style: topSummaryStyle"><div class="kgHeaderScroller" data-bind="style: headerScrollerStyle, kgTopSummaryRow: $data" ><\/div><\/div><div class="kgHeaderButton" data-bind="visible: ($data.showColumnMenu || $data.showFilter), click: toggleShowMenu"><div class="kgHeaderButtonArrow"><\/div><\/div><div data-bind="visible: showMenu" class="kgColMenu"><div data-bind="visible: showFilter"><input placeholder="Seach Field:Value" type="text" data-bind="value: filterText, valueUpdate: \'afterkeydown\'"/><\/div><div data-bind="visible: showColumnMenu"><span class="kgMenuText">Choose Columns:<\/span><ul class="kgColList" data-bind="foreach: nonAggColumns"><li class="kgColListItem"><label style="position: relative;"><input type="checkbox" class="kgColListCheckbox" data-bind="checked: visible"/><span data-bind="text: displayName, click: toggleVisible"><\/span><a title="Group By" data-bind="attr: {\'class\': groupedByClass }, visible: (field != \'✔\'), click: $parent.groupBy"><\/a><span class="kgGroupingNumber" data-bind="visible: groupIndex() > 0, text: groupIndex"><\/span><\/label><\/li><\/ul><\/div><\/div><\/div><div class="kgViewport" data-bind="css: {\'ui-widget-content\': jqueryUITheme}, style: viewportStyle"><div class="kgCanvas" data-bind="style: canvasStyle"><div data-bind="foreach: renderedRows" style="position: absolute;"><div data-bind="style: { \'top\': offsetTop, \'height\': $parent.rowHeight + \'px\' }, click: toggleSelected, css: {\'selected\': selected, \'even\': isEven , \'odd\': isOdd, \'ui-state-default\': $parent.jqueryUITheme && isOdd, \'ui-state-active\':$parent.jqueryUITheme && isEven}, kgRow: $data" class="kgRow"><\/div><\/div><\/div><\/div><div class="kgFooterPanel" data-bind="css: {\'ui-widget-content\': jqueryUITheme, \'ui-corner-bottom\': jqueryUITheme}, style: footerStyle"><div class="kgTotalSelectContainer" data-bind="visible: footerVisible"><div class="kgFooterTotalItems" data-bind="css: {\'kgNoMultiSelect\': !multiSelect}" ><span class="kgLabel">Total Items: <span data-bind="text: maxRowsDisplay"><\/span><\/span><span data-bind="visible: filterText().length > 0" class="kgLabel">(Showing: <span data-bind="text: totalFilteredItemsLength"><\/span>)<\/span><\/div><div class="kgFooterSelectedItems" data-bind="visible: multiSelect"><span class="kgLabel">Selected Items: <span data-bind="text: selectedItemCount"><\/span><\/span><\/div><\/div><div class="kgPagerContainer" style="float: right; margin-top: 10px;" data-bind="visible: (footerVisible && enablePaging), css: {\'kgNoMultiSelect\': !multiSelect}"><div style="float:left; margin-right: 10px;" class="kgRowCountPicker"><span style="float: left; margin-top: 3px;" class="kgLabel">Page Size:<\/span><select style="float: left;height: 27px; width: 100px" data-bind="value: pagingOptions.pageSize, options: pagingOptions.pageSizes"><\/select><\/div><div style="float:left; margin-right: 10px; line-height:25px;" class="kgPagerControl" style="float: left; min-width: 135px;"><button class="kgPagerButton" data-bind="click: pageToFirst, disable: cantPageBackward()" title="First Page"><div class="kgPagerFirstTriangle"><div class="kgPagerFirstBar"><\/div><\/div><\/button><button class="kgPagerButton" data-bind="click: pageBackward, disable: cantPageBackward()" title="Previous Page"><div class="kgPagerFirstTriangle kgPagerPrevTriangle"><\/div><\/button><input class="kgPagerCurrent" type="number" style="width:50px; height: 24px; margin-top: 1px; padding: 0px 4px;" data-bind="value: pagingOptions.currentPage, valueUpdate: \'afterkeydown\'"/><button class="kgPagerButton" data-bind="click: pageForward, disable: cantPageForward()" title="Next Page"><div class="kgPagerLastTriangle kgPagerNextTriangle"><\/div><\/button><button class="kgPagerButton" data-bind="click: pageToLast, disable: cantPageForward()" title="Last Page"><div class="kgPagerLastTriangle"><div class="kgPagerLastBar"><\/div><\/div><\/button><\/div><\/div><\/div><\/div>' }, n.kg.defaultRowTemplate = function () { return "<div data-bind=\"style: { cursor : canSelectRows ? 'pointer' : 'default' }, foreach: $grid.visibleColumns, css: { 'ui-widget-content': $grid.jqueryUITheme }\"><div data-bind=\"attr: { 'class': cellClass() + ' kgCell col' + $index() }, kgCell: $data\"><\/div><\/div>" }, n.kg.defaultCellTemplate = function () { return "<div data-bind=\"attr: { 'class': 'kgCellText colt' + $index()}, html: $data.getProperty($parent)\"><\/div>" }, n.kg.defaultAggregateSummaryCellTemplate = function () { return "<div data-bind=\"attr: { 'class': 'kgAggCellText colt' + ($index() + $parent.$grid.firstRealColumnIndex() + 1)}, html: window.kg.utils.isNullOrUndefined(summaryFunction) || $data.field == '' || $data.field == '✔' ? '' : summaryFunction($.map($parent.children, function(row, i) {return row[$data.field];}))\"><\/div>" }, n.kg.aggregateTemplate = function () { return '<div data-bind="click: toggleExpand, style: {\'left\': offsetLeft()}" class="kgAggregate"><span class="kgAggregateText" data-bind="html: $data.label">(<span data-bind="html: totalChildren"><\/span> Items)<\/span><div data-bind="attr: {\'class\' : aggClass }"><\/div><\/div>' }, n.kg.aggregateSummaryTemplate = function () { return "<div data-bind=\"click: toggleExpand, style: {'left': offsetLeft()}\" class=\"kgAggregate\"><div><div data-bind=\"attr: {'class' : 'kgAggCellLeft aggTitleCol' + depth}\"><div class=\"kgAggCellText\" data-bind=\"html: $data.label\">(<span data-bind=\"html: totalChildren\"><\/span> Items)<\/div><\/div>\t<div data-bind=\"style: {'left': '-' + offsetLeft()}, attr: {'class': 'kgAggSummmaryCols'} ,visible: $grid.anyAggregateRowColumn,foreach: $grid.aggregateRowColumns\"><div data-bind=\"attr: { 'class': cellClass() + ' kgAggCell col' + ($index() + $parent.$grid.firstRealColumnIndex() + 1)}, kgAggSumCell: $data\"><\/div><\/div>\t<\/div>\t<div data-bind=\"attr: {'class' : aggClass }\"><\/div><\/div>" }, n.kg.defaultHeaderRowTemplate = function () { return "<div data-bind=\"foreach: visibleColumns\"><div data-bind=\"kgHeaderCell: $data, attr: { 'class': 'kgHeaderCell col' + $index() }\"><\/div><\/div>" }, n.kg.defaultHeaderCellTemplate = function () { return "<div data-bind=\"style: { cursor : sortable() ? 'pointer' : 'default' }, click: sort, css: {'kgSorted': !noSortVisible }, attr: {'class': 'kgHeaderSortColumn ' + headerClass()}\"><div data-bind=\"attr: { 'class': 'colt' + $index() + ' kgHeaderText' }, html: displayName\"><\/div><div class=\"kgSortButtonDown\" data-bind=\"visible: showSortButtonDown\"><\/div><div class=\"kgSortButtonUp\" data-bind=\"visible: showSortButtonUp\"><\/div><div data-bind=\"visible: resizable, click: gripClick, mouseEvents: { mouseDown: gripOnMouseDown }\" class=\"kgHeaderGrip\" ><\/div><\/div>" }, n.kg.defaultTopSummaryRowTemplate = function () { return "<div data-bind=\"foreach: visibleColumns\"><div data-bind=\"kgTopSummaryCell: $data, attr: { 'class': 'kgTopSummaryCell col' + $index() }\"><\/div><\/div>" }, n.kg.defaultTopSummaryCellTemplate = function () { return "<div data-bind=\"attr: {'class': topSummaryClass()}\"><div data-bind=\"attr: { 'class': 'colt' + $index() + ' kgTopSummaryText' }, html: window.kg.utils.isNullOrUndefined(summaryFunction) || $data.field == '' || $data.field == '✔' ? '' : summaryFunction($.map($parent.config.data(), function(row, i) {return row[$data.field];}))\"><\/div><\/div>" }, ko.bindingHandlers.koGrid = function () { return { init: function (t, i, r, u, f) { var o = i(), s = $(t), l, e, h, c; return o.gridDim = new n.kg.Dimension({ outerHeight: ko.observable(s.height()), outerWidth: ko.observable(s.width()) }), l = o.groups, o.groups = [], e = new n.kg.Grid(o), h = $(n.kg.defaultGridTemplate()), o.data.subscribe(function () { e.$$selectionPhase || (e.searchProvider.evalFilter(), e.refreshDomSizes()) }), o.selectedItems != undefined && o.selectedItems.subscribeArrayChanged(function (n) { e.$$selectionPhase || $.each(e.rowFactory.rowCache, function (t, i) { if (i.entity == n) { e.selectionService.setSelection(i, !0); return } }) }, function (n) { e.$$selectionPhase || $.each(e.rowFactory.rowCache, function (t, i) { if (i.entity == n) { e.selectionService.setSelection(i, !1); return } }) }), ko.isObservable(o.columnDefs) && o.columnDefs.subscribe(function (n) { e.columns([]), e.config.columnDefs = n, e.buildColumns(), e.configureColumnWidths() }), s.addClass("koGrid").addClass(e.gridId.toString()), s.append(h), e.$userViewModel = f.$data, ko.applyBindings(e, h[0]), n.kg.domUtilityService.AssignGridContainers(s, e), e.configureColumnWidths(), e.refreshDomSizes(), e.eventProvider = new n.kg.EventProvider(e), $.each(e.config.plugins, function (n, t) { if (typeof t.onGridInit == "function") t.onGridInit(e) }), n.kg.domUtilityService.BuildStyles(e), c = [], $.each(l, function (n, t) { $.each(e.columns(), function (n, i) { i.field == t && c.push(i) }) }), $.each(c, function (n, t) { e.groupBy(t) }), { controlsDescendantBindings: !0 } } } }(), ko.bindingHandlers.kgRow = function () { return { init: function (n, t, i, r, u) { var f = t(), s = f.$grid = u.$parent, e, o; return e = f.isAggRow ? s.aggregateRowTemplate : s.rowTemplate, o = function (t) { var i = $(t); f.$userViewModel = u.$parent.$userViewModel, ko.applyBindings(f, i[0]), $(n).html(i) }, e.then ? e.then(function (n) { o(n) }) : o(e), { controlsDescendantBindings: !0 } } } }(), ko.bindingHandlers.kgCell = function () { return { init: function (n, t, i, r, u) { u.$userViewModel = u.$parent.$userViewModel; var f = function (t) { var i = $(t); ko.applyBindings(u, i[0]), $(n).html(i) }; return r.cellTemplate.then ? r.cellTemplate.then(function (n) { f(n) }) : f(r.cellTemplate), { controlsDescendantBindings: !0 } } } }(), ko.bindingHandlers.kgAggSumCell = function () { return { init: function (n, t, i, r, u) { u.$userViewModel = u.$parent.$userViewModel; var f = function (t) { var i = $(t); ko.applyBindings(u, i[0]), $(n).html(i) }; return r.aggregateSummaryCellTemplate.then ? r.aggregateSummaryCellTemplate.then(function (n) { f(n) }) : f(r.aggregateSummaryCellTemplate), { controlsDescendantBindings: !0 } } } }(), ko.bindingHandlers.kgHeaderRow = function () { return { init: function (n, t, i, r, u) { u.$userViewModel = u.$data.$userViewModel; var f = function (t) { var i = $(t); ko.applyBindings(u, i[0]), $(n).html(i) }; return r.headerRowTemplate.then ? r.headerRowTemplate.then(function (n) { f(n) }) : f(r.headerRowTemplate), { controlsDescendantBindings: !0 } } } }(), ko.bindingHandlers.kgHeaderCell = function () { return { init: function (n, t, i, r, u) { var e = u.extend({ $grid: u.$parent, $userViewModel: u.$parent.$userViewModel }), f = function (t) { var i = $(t); ko.applyBindings(e, i[0]), $(n).html(i) }; return r.headerCellTemplate.then ? r.headerCellTemplate.then(function (n) { f(n) }) : f(r.headerCellTemplate), { controlsDescendantBindings: !0 } } } }(), ko.bindingHandlers.kgTopSummaryRow = function () { return { init: function (n, t, i, r, u) { u.$userViewModel = u.$data.$userViewModel; var f = function (t) { var i = $(t); ko.applyBindings(u, i[0]), $(n).html(i) }; return r.topSummaryRowTemplate.then ? r.topSummaryRowTemplate.then(function (n) { f(n) }) : f(r.topSummaryRowTemplate), { controlsDescendantBindings: !0 } } } }(), ko.bindingHandlers.kgTopSummaryCell = function () { return { init: function (n, t, i, r, u) { var e = u.extend({ $grid: u.$parent, $userViewModel: u.$parent.$userViewModel }), f = function (t) { var i = $(t); ko.applyBindings(e, i[0]), $(n).html(i) }; return r.topSummaryCellTemplate.then ? r.topSummaryCellTemplate.then(function (n) { f(n) }) : f(r.topSummaryCellTemplate), { controlsDescendantBindings: !0 } } } }(), ko.bindingHandlers.mouseEvents = function () { return { init: function (n, t) { var i = t(); i.mouseDown && $(n).mousedown(i.mouseDown) } } }(), n.kg.Aggregate = function (n, t) { var i = this; i.index = 0, i.offsetTop = ko.observable(0), i.entity = n, i.label = ko.observable(n.gLabel), i.field = n.gField, i.depth = n.gDepth, i.parent = n.parent, i.children = n.children, i.aggChildren = n.aggChildren, i.aggIndex = n.aggIndex, i.collapsed = ko.observable(!0), i.isAggRow = !0, i.offsetLeft = ko.observable((n.gDepth * 25).toString() + "px"), i.aggLabelFilter = n.aggLabelFilter, i.toggleExpand = function () { var n = i.collapsed(); i.collapsed(!n), i.notifyChildren() }, i.setExpand = function (n) { i.collapsed(n), i.notifyChildren() }, i.getOffsetTopInt = function () { var n = ("" + i.offsetTop()).indexOf("px"); return n < 0 ? parseInt(i.offsetTop()) : parseInt(("" + i.offsetTop()).slice(0, n)) }, i.notifyChildren = function () { $.each(i.aggChildren, function (n, t) { if (t.entity[u] = i.collapsed(), i.collapsed()) { var r = i.collapsed(); t.setExpand(r) } }), $.each(i.children, function (n, t) { t[u] = i.collapsed() }), t.rowCache = []; var n = !1; $.each(t.aggCache, function (t, r) { if (n) { var u = 30 * i.children.length, f = i.collapsed(); r.offsetTop(f ? r.getOffsetTopInt() - u + "px" : r.getOffsetTopInt() + u + "px") } else t == i.aggIndex && (n = !0) }), t.renderedChange() }, i.aggClass = ko.computed(function () { return i.collapsed() ? "kgAggArrowCollapsed" : "kgAggArrowExpanded" }), i.totalChildren = ko.computed(function () { if (i.aggChildren.length > 0) { var n = 0, t = function (i) { i.aggChildren.length > 0 ? $.each(i.aggChildren, function (n, i) { t(i) }) : n += i.children.length }; return t(i), n } return i.children.length }), i.selected = ko.observable(!1), i.isEven = ko.observable(!1), i.isOdd = ko.observable(!1), i.toggleSelected = function () { return !0 } }, n.kg.Column = function (t, r) { var u = this, e = t.colDef, h = 500, o = 0, s = null; u.eventTaget = undefined, u.width = e.width, u.groupIndex = ko.observable(0), u.isGroupedBy = ko.observable(!1), u.groupedByClass = ko.computed(function () { return u.isGroupedBy() ? "kgGroupedByIcon" : "kgGroupIcon" }), u.sortable = ko.observable(!1), u.resizable = ko.observable(!1), u.minWidth = e.minWidth ? e.minWidth : 50, u.maxWidth = e.maxWidth ? e.maxWidth : 9e3, u.headerRowHeight = t.headerRowHeight, u.displayName = ko.observable(e.displayName || e.field), u.summaryFunction = e.summaryFunction, u.index = t.index, u.isAggCol = t.isAggCol, u.cellClass = ko.observable(e.cellClass || ""), u.cellFilter = e.cellFilter || e.cellFormatter, u.field = e.field, u.aggLabelFilter = e.cellFilter || e.cellFormatter || e.aggLabelFilter || e.aggLabelFormatter, u._visible = ko.observable(n.kg.utils.isNullOrUndefined(e.visible) || e.visible), u.visible = ko.computed({ read: function () { return u._visible() }, write: function (n) { u.toggleVisible(n) } }), t.enableSort && u.sortable(n.kg.utils.isNullOrUndefined(e.sortable) || e.sortable), t.enableResize && u.resizable(n.kg.utils.isNullOrUndefined(e.resizable) || e.resizable), u.sortDirection = ko.observable(undefined), u.sortingAlgorithm = e.sortFn, u.headerClass = ko.observable(e.headerClass), u.topSummaryClass = ko.observable(e.topSummaryClass), u.headerCellTemplate = e.headerCellTemplate || n.kg.defaultHeaderCellTemplate(), u.topSummaryCellTemplate = e.topSummaryCellTemplate || n.kg.defaultTopSummaryCellTemplate(), u.cellTemplate = e.cellTemplate || n.kg.defaultCellTemplate(), u.aggregateSummaryCellTemplate = e.aggregateSummaryCellTemplate || n.kg.defaultAggregateSummaryCellTemplate(), e.cellTemplate && !i.test(e.cellTemplate) && (u.cellTemplate = n.kg.utils.getTemplatePromise(e.cellTemplate)), e.topSummaryCellTemplate && !i.test(e.topSummaryCellTemplate) && (u.topSummaryCellTemplate = n.kg.utils.getTemplatePromise(e.topSummaryCellTemplate)), e.headerCellTemplate && !i.test(e.headerCellTemplate) && (u.headerCellTemplate = n.kg.utils.getTemplatePromise(e.headerCellTemplate)), e.aggregateSummaryCellTemplate && !i.test(e.aggregateSummaryCellTemplate) && (u.aggregateSummaryCellTemplate = n.kg.utils.getTemplatePromise(e.aggregateSummaryCellTemplate)), u.getProperty = function (n) { return u.cellFilter ? u.cellFilter(n.getProperty(u.field)) : n.getProperty(u.field) }, u.toggleVisible = function (t) { var i; i = n.kg.utils.isNullOrUndefined(t) || typeof t == "object" ? !u._visible() : t, u._visible(i), n.kg.domUtilityService.BuildStyles(r) }, u.showSortButtonUp = ko.computed(function () { return u.sortable ? u.sortDirection() === c : u.sortable }), u.showSortButtonDown = ko.computed(function () { return u.sortable ? u.sortDirection() === f : u.sortable }), u.noSortVisible = ko.computed(function () { return !u.sortDirection() }), u.sort = function () { if (!u.sortable()) return !0; var n = u.sortDirection() === f ? c : f; return u.sortDirection(n), t.sortCallback(u, n), !1 }, u.gripClick = function (n, i) { i.stopPropagation(), o++, o === 1 ? s = setTimeout(function () { o = 0 }, h) : (clearTimeout(s), t.resizeOnDataCallback(u), o = 0) }, u.gripOnMouseDown = function (t) { return (t.stopPropagation(), t.ctrlKey) ? (u.toggleVisible(), n.kg.domUtilityService.BuildStyles(r), r.config.columnsChanged(r.columns.peek()), !0) : (u.eventTaget = t.target.parentElement, u.eventTaget.style.cursor = "col-resize", u.startMousePosition = t.clientX, u.origWidth = u.width, $(document).mousemove(u.onMouseMove), $(document).mouseup(u.gripOnMouseUp), !1) }, u.onMouseMove = function (t) { t.stopPropagation(); var f = t.clientX - u.startMousePosition, i = f + u.origWidth; return u.width = i < u.minWidth ? u.minWidth : i > u.maxWidth ? u.maxWidth : i, n.kg.domUtilityService.BuildStyles(r), !1 }, u.gripOnMouseUp = function (n) { return n.stopPropagation(), $(document).off("mousemove"), $(document).off("mouseup"), u.eventTaget.style.cursor = u.sortable() ? "pointer" : "default", u.eventTaget = undefined, r.config.columnsChanged(r.columns.peek()), !1 } }, n.kg.Dimension = function (n) { this.outerHeight = null, this.outerWidth = null, $.extend(this, n) }, n.kg.EventProvider = function (t) { var i = this; i.colToMove = undefined, i.groupToMove = undefined, i.assignEvents = function () { if (t.config.enableColumnDragAndDrop) { if (t.config.jqueryUIDraggable) t.$groupPanel.droppable({ addClasses: !1, drop: function (n) { i.onGroupDrop(n) } }), $(document).ready(i.setDraggables); else { t.$groupPanel.on("mousedown", i.onGroupMouseDown).on("dragover", i.dragOver).on("drop", i.onGroupDrop); t.$headerScroller.on("mousedown", i.onHeaderMouseDown).on("dragover", i.dragOver).on("drop", i.onHeaderDrop); if (t.config.enableRowReordering) t.$viewport.on("mousedown", i.onRowMouseDown).on("dragover", i.dragOver).on("drop", i.onRowDrop); i.setDraggables() } t.columns.subscribe(i.setDraggables) } }, i.dragOver = function (n) { n.preventDefault() }, i.setDraggables = function () { t.config.jqueryUIDraggable ? t.$root.find(".kgHeaderSortColumn").draggable({ helper: "clone", appendTo: "body", stack: "div", addClasses: !1, start: function (n) { i.onHeaderMouseDown(n) } }).droppable({ drop: function (n) { i.onHeaderDrop(n) } }) : (t.$root.find(".kgHeaderSortColumn").attr("draggable", "true"), navigator.userAgent.indexOf("MSIE") != -1 && t.$root.find(".kgHeaderSortColumn").bind("selectstart", function () { return this.dragDrop(), !1 })) }, i.onGroupMouseDown = function (n) { var r = $(n.target), u; r[0].className != "kgRemoveGroup" ? (u = ko.dataFor(r[0]), u && (t.config.jqueryUIDraggable || r.attr("draggable", "true"), i.groupToMove = { header: r, groupName: u, index: u.groupIndex() - 1 })) : i.groupToMove = undefined }, i.onGroupDrop = function (n) { var r, u; i.groupToMove ? (r = $(n.target).closest(".kgGroupElement"), r.context.className == "kgGroupPanel" ? (t.configGroups.splice(i.groupToMove.index, 1), t.configGroups.push(i.groupToMove.groupName)) : (u = ko.dataFor(r[0]), u && i.groupToMove.index != u.groupIndex() && (t.configGroups.splice(i.groupToMove.index, 1), t.configGroups.splice(u.groupIndex(), 0, i.groupToMove.groupName))), i.groupToMove = undefined, t.fixGroupIndexes()) : (t.configGroups.indexOf(i.colToMove.col) == -1 && (r = $(n.target).closest(".kgGroupElement"), r.context.className == "kgGroupPanel" || r.context.className == "kgGroupPanelDescription" ? t.groupBy(i.colToMove.col) : (u = ko.dataFor(r[0]), u && t.removeGroup(u.groupIndex()))), i.colToMove = undefined) }, i.onHeaderMouseDown = function (n) { var t = $(n.target).closest(".kgHeaderSortColumn"), r; return t[0] ? (r = ko.dataFor(t[0]), r && (i.colToMove = { header: t, col: r }), !0) : !0 }, i.onHeaderDrop = function (r) { var e, u, f; if (!i.colToMove || (e = $(r.target).closest(".kgHeaderSortColumn"), !e[0])) return !0; if (u = ko.dataFor(e[0]), u) { if (i.colToMove.col == u) return !0; f = t.columns.peek(), f.splice(i.colToMove.col.index, 1), f.splice(u.index, 0, i.colToMove.col), t.fixColumnIndexes(), t.columns(f), n.kg.domUtilityService.BuildStyles(t), i.colToMove = undefined } return !0 }, i.onRowMouseDown = function (t) { var i = $(t.target).closest(".kgRow"), r; i[0] && (r = ko.dataFor(i[0]), r && (i.attr("draggable", "true"), n.kg.eventStorage.rowToMove = { targetRow: i, scope: r })) }, i.onRowDrop = function (i) { var e = $(i.target).closest(".kgRow"), u = ko.dataFor(e[0]), r; if (u) { if (r = n.kg.eventStorage.rowToMove, r.scope == u) return; var f = t.sortedData(), o = f.indexOf(r.scope.entity), s = f.indexOf(u.entity); t.sortedData.splice(o, 1), t.sortedData.splice(s, 0, r.scope.entity), t.searchProvider.evalFilter(), n.kg.eventStorage.rowToMove = undefined } }, i.assignGridEventHandlers = function () { t.$viewport.scroll(function (n) { var i = n.target.scrollLeft, r = n.target.scrollTop; t.adjustScrollLeft(i), t.adjustScrollTop(r) }), t.$viewport.off("keydown"); t.$viewport.on("keydown", function (i) { return n.kg.moveSelectionHandler(t, i) }); t.config.tabIndex === -1 ? (t.$viewport.attr("tabIndex", n.kg.numberOfGrids), n.kg.numberOfGrids++) : t.$viewport.attr("tabIndex", t.config.tabIndex), $(n).resize(function () { n.kg.domUtilityService.UpdateGridLayout(t), t.config.maintainColumnRatios && t.configureColumnWidths() }) }, i.assignGridEventHandlers(), i.assignEvents() }, n.kg.RowFactory = function (i) { var f = this; f.rowCache = [], f.aggCache = {}, f.parentCache = [], f.dataChanged = !0, f.parsedData = [], f.rowConfig = {}, f.selectionService = i.selectionService, f.rowHeight = 30, f.numberOfAggregates = 0, f.groupedData = undefined, f.rowHeight = i.config.rowHeight, f.rowConfig = { canSelectRows: i.config.canSelectRows, rowClasses: i.config.rowClasses, selectedItems: i.config.selectedItems, selectWithCheckboxOnly: i.config.selectWithCheckboxOnly, beforeSelectionChangeCallback: i.config.beforeSelectionChange, afterSelectionChangeCallback: i.config.afterSelectionChange }, f.renderedRange = new n.kg.Range(0, i.minRowsToRender() + r), f.buildEntityRow = function (i, r) { var u = f.rowCache[r]; return u || (u = new n.kg.Row(i, f.rowConfig, f.selectionService), u.rowIndex(r + 1), u.offsetTop((f.rowHeight * r).toString() + "px"), u.selected(i[t]), f.rowCache[r] = u), u }, f.buildAggregateRow = function (t, i) { var r = f.aggCache[t.aggIndex]; return r || (r = new n.kg.Aggregate(t, f), f.aggCache[t.aggIndex] = r), r.index = i + 1, r.offsetTop((f.rowHeight * i).toString() + "px"), r }, f.UpdateViewableRange = function (n) { f.renderedRange = n, f.renderedChange() }, f.filteredDataChanged = function () { i.lateBoundColumns && i.filteredData().length > 1 && (i.config.columnDefs = undefined, i.buildColumns(), i.lateBoundColumns = !1), f.dataChanged = !0, f.rowCache = [], i.config.groups.length > 0 && f.getGrouping(i.config.groups), f.UpdateViewableRange(f.renderedRange) }, f.renderedChange = function () { if (!f.groupedData || i.config.groups.length < 1) { f.renderedChangeNoGroups(), i.refreshDomSizes(); return } f.parentCache = []; var n = [], t = f.parsedData.filter(function (n) { return n[u] === !1 }).slice(f.renderedRange.topRow, f.renderedRange.bottomRow); $.each(t, function (t, i) { var r; r = i.isAggRow ? f.buildAggregateRow(i, f.renderedRange.topRow + t) : f.buildEntityRow(i, f.renderedRange.topRow + t), n.push(r) }), i.setRenderedRows(n), i.refreshDomSizes() }, f.renderedChangeNoGroups = function () { var n = [], t = i.filteredData.slice(f.renderedRange.topRow, f.renderedRange.bottomRow); $.each(t, function (t, i) { var r = f.buildEntityRow(i, f.renderedRange.topRow + t); n.push(r) }), i.setRenderedRows(n) }, f.parseGroupData = function (n) { var i, t; if (n.values) $.each(n.values, function (n, t) { f.parentCache[f.parentCache.length - 1].children.push(t), f.parsedData.push(t) }); else for (i in n) if (i == e || i == o || i == s) continue; else n.hasOwnProperty(i) && (t = f.buildAggregateRow({ gField: n[e], gLabel: i, gDepth: n[o], isAggRow: !0, _kg_hidden_: !1, children: [], aggChildren: [], aggIndex: f.numberOfAggregates, aggLabelFilter: n[s].aggLabelFilter }, 0), f.numberOfAggregates++, t.parent = f.parentCache[t.depth - 1], t.parent && (t.parent.collapsed(!1), t.parent.aggChildren.push(t)), f.parsedData.push(t.entity), f.parentCache[t.depth] = t, f.parseGroupData(n[i])) }, f.getGrouping = function (t) { f.aggCache = [], f.rowCache = [], f.numberOfAggregates = 0, f.groupedData = {}; var h = i.filteredData(), c = t.length, r = i.columns(); $.each(h, function (h, l) { l[u] = !0; var a = f.groupedData; $.each(t, function (t, u) { !r[t].isAggCol && t <= c && (i.columns.splice(l.gDepth, 0, new n.kg.Column({ colDef: { field: "", width: 25, sortable: !1, resizable: !1, headerCellTemplate: '<div class="kgAggHeader"><\/div>', topSummaryCellTemplate: '<div class="kgAggTopSummary"><\/div>' }, isAggCol: !0, index: l.gDepth, headerRowHeight: i.config.headerRowHeight })), n.kg.domUtilityService.BuildStyles(i)); var h = r.filter(function (n) { return n.field == u })[0], f = n.kg.utils.evalProperty(l, u); h.cellFilter && (f = h.cellFilter(f)), f = f ? f.toString() : "null", a[f] || (a[f] = {}), a[e] || (a[e] = u), a[o] || (a[o] = t), a[s] || (a[s] = h), a = a[f] }), a.values || (a.values = []), a.values.push(l) }), i.fixColumnIndexes(), f.parsedData.length = 0, f.parseGroupData(f.groupedData), i.configureColumnWidths() }, i.config.groups.length > 0 && i.filteredData().length > 0 && f.getGrouping(i.config.groups) }, n.kg.Grid = function (f) { var o = { rowHeight: 30, columnWidth: 100, headerRowHeight: 30, footerRowHeight: 55, footerVisible: !0, displayFooter: undefined, canSelectRows: !0, selectAllState: ko.observable(!1), data: ko.observableArray([]), columnDefs: undefined, selectedItems: ko.observableArray([]), displaySelectionCheckbox: !0, selectWithCheckboxOnly: !1, useExternalSorting: !1, sortInfo: ko.observable(undefined), multiSelect: !0, tabIndex: -1, enableColumnResize: !0, enableColumnDragAndDrop: !0, enableSorting: !0, maintainColumnRatios: undefined, beforeSelectionChange: function () { return !0 }, afterSelectionChange: function () { }, columnsChanged: function () { }, rowTemplate: undefined, headerRowTemplate: undefined, topSummaryRowTemplate: undefined, aggregateRowTemplate: undefined, jqueryUITheme: !1, jqueryUIDraggable: !1, plugins: [], keepLastSelected: !0, groups: [], showGroupPanel: !1, showTopSummary: !1, showAggregateSummary: !1, enableRowReordering: !1, showColumnMenu: !0, showFilter: !0, disableTextSelection: !0, filterOptions: { filterText: ko.observable(""), useExternalFilter: !1 }, enablePaging: !1, pagingOptions: { pageSizes: ko.observableArray([250, 500, 1e3]), pageSize: ko.observable(250), totalServerItems: ko.observable(0), currentPage: ko.observable(1) } }, e = this; e.maxCanvasHt = ko.observable(0), e.config = $.extend(o, f), e.config.columnDefs = ko.utils.unwrapObservable(f.columnDefs), e.gridId = "ng" + n.kg.utils.newId(), e.$root = null, e.$groupPanel = null, e.$topPanel = null, e.$headerContainer = null, e.$topSummaryContainer = null, e.$headerScroller = null, e.$headers = null, e.$viewport = null, e.$canvas = null, e.rootDim = e.config.gridDim, e.sortInfo = ko.isObservable(e.config.sortInfo) ? e.config.sortInfo : ko.observable(e.config.sortInfo), e.sortedData = e.config.data, e.lateBindColumns = !1, e.filteredData = ko.observableArray([]), e.lastSortedColumn = undefined, e.showFilter = e.config.showFilter, e.filterText = e.config.filterOptions.filterText, e.disableTextSelection = ko.observable(e.config.disableTextSelection), e.calcMaxCanvasHeight = function () { return e.configGroups().length > 0 ? e.rowFactory.parsedData.filter(function (n) { return n[u] === !1 }).length * e.config.rowHeight : e.filteredData().length * e.config.rowHeight }, e.elementDims = { scrollW: 0, scrollH: 0, rowIndexCellW: 25, rowSelectedCellW: 25, rootMaxW: 0, rootMaxH: 0 }, e.setRenderedRows = function (n) { e.renderedRows(n), e.refreshDomSizes() }, e.minRowsToRender = function () { var n = e.viewportDimHeight() || 1; return Math.floor(n / e.config.rowHeight) }, e.refreshDomSizes = function () { e.rootDim.outerWidth(e.elementDims.rootMaxW), e.rootDim.outerHeight(e.elementDims.rootMaxH), e.maxCanvasHt(e.calcMaxCanvasHeight()) }, e.buildColumnDefsFromData = function () { var i = e.sortedData(), r; if (e.config.columnDefs || (e.config.columnDefs = []), !i || !i[0]) { e.lateBoundColumns = !0; return } r = i[0], n.kg.utils.forIn(r, function (n, i) { i != t && e.config.columnDefs.push({ field: i }) }) }, e.buildColumns = function () { var t = e.config.columnDefs, i = []; t || (e.buildColumnDefsFromData(), t = e.config.columnDefs), e.config.displaySelectionCheckbox && e.config.canSelectRows && t.splice(0, 0, { field: "✔", width: e.elementDims.rowSelectedCellW, sortable: !1, resizable: !1, headerCellTemplate: '<input class="kgSelectionHeader" type="checkbox" data-bind="visible: $grid.multiSelect, checked: $grid.allSelected"/>', topSummaryCellTemplate: '<div class="kgSelectionTopSummary"><\/div>', cellTemplate: '<div class="kgSelectionCell"><input class="kgSelectionCheckbox" type="checkbox" data-bind="checked: $parent.selected" /><\/div>' }), t.length > 0 && ($.each(t, function (t, r) { var f = new n.kg.Column({ colDef: r, index: t, headerRowHeight: e.config.headerRowHeight, sortCallback: e.sortData, resizeOnDataCallback: e.resizeOnData, enableResize: e.config.enableColumnResize, enableSort: e.config.enableSorting }, e), u; i.push(f), u = e.config.groups.indexOf(r.field), u != -1 && e.configGroups.splice(u, 0, f) }), e.columns(i)) }, e.configureColumnWidths = function () { for (var l = e.config.columnDefs, o = [], s = [], h = 0, u = 0, i = e.columns(), t = [], a = i.length, c, f, r = 0; r < i.length; r++) i[r].field == "" ? u += i[r].width : t.push(i[r]); $.each(l, function (i, r) { var c = !1, f = undefined, l; if (n.kg.utils.isNullOrUndefined(r.width) ? r.width = "*" : (c = isNaN(r.width) ? n.kg.utils.endsWith(r.width, "%") : !1, f = c ? r.width : parseInt(r.width, 10)), isNaN(f)) { if (f = r.width, f == "auto") { t[i].width = t[i].minWidth, l = t[i], $(document).ready(function () { e.resizeOnData(l, !0) }); return } if (f.indexOf("*") != -1) { h += f.length, r.index = i, o.push(r); return } if (c) { r.index = i, s.push(r); return } throw 'unable to parse column width, use percentage ("10%","20%", etc...) or "*" to use remaining width of grid'; } else u += t[i].width = parseInt(r.width, 10) }), o.length > 0 && (e.config.maintainColumnRatios === !1 ? $.noop() : e.config.maintainColumnRatios = !0, f = e.rootDim.outerWidth() - u, c = Math.floor(f / h), $.each(o, function (i, r) { var o = r.width.length, f; t[r.index].width = c * o, r.index + 1 == a && (f = 2, e.maxCanvasHt() > e.viewportDimHeight() && (f += n.kg.domUtilityService.ScrollW), t[r.index].width -= f), u += t[r.index].width })), s.length > 0 && (f = e.rootDim.outerWidth() - u, $.each(s, function (n, i) { var r = i.width; t[i.index].width = Math.floor(f * (parseInt(r.slice(0, -1), 10) / 100)) })), e.columns(i), n.kg.domUtilityService.BuildStyles(e) }, e.init = function () { e.selectionService = new n.kg.SelectionService(e), e.rowFactory = new n.kg.RowFactory(e), e.selectionService.Initialize(e.rowFactory), e.searchProvider = new n.kg.SearchProvider(e), e.styleProvider = new n.kg.StyleProvider(e), e.buildColumns(), n.kg.sortService.columns = e.columns, e.configGroups.subscribe(function (n) { if (n) { var t = []; $.each(n, function (n, i) { i && t.push(i.field || i) }), e.config.groups = t, e.rowFactory.filteredDataChanged() } }), e.filteredData.subscribe(function () { e.$$selectionPhase || (e.maxCanvasHt(e.calcMaxCanvasHeight()), e.isSorting || e.configureColumnWidths()) }), e.maxCanvasHt(e.calcMaxCanvasHeight()), e.searchProvider.evalFilter(), e.refreshDomSizes() }, e.prevScrollTop = 0, e.prevScrollIndex = 0, e.adjustScrollTop = function (t, i) { if (e.prevScrollTop !== t || i) { var u = Math.floor(t / e.config.rowHeight); e.prevScrollTop < t && u < e.prevScrollIndex + h || e.prevScrollTop > t && u > e.prevScrollIndex - h || (e.prevScrollTop = t, e.rowFactory.UpdateViewableRange(new n.kg.Range(Math.max(0, u - r), u + e.minRowsToRender() + r)), e.prevScrollIndex = u) } }, e.adjustScrollLeft = function (n) { e.$headerContainer && e.$headerContainer.scrollLeft(n), e.$topSummaryContainer && e.$topSummaryContainer.scrollLeft(n) }, e.resizeOnData = function (t) { var i = t.minWidth, r = n.kg.utils.getElementsByClassName("col" + t.index); $.each(r, function (t, r) { var u, f, o, s; t === 0 ? (f = $(r).find(".kgHeaderText"), u = n.kg.utils.visualLength(f) + 10) : t == 1 && e.config.showTopSummary ? (o = $(r).find(".kgTopSummaryText"), u = n.kg.utils.visualLength(o) + 10) : (s = $(r).find(".kgCellText"), u = n.kg.utils.visualLength(s) + 10), u > i && (i = u) }), t.width = i = Math.min(t.maxWidth, i + 7), n.kg.domUtilityService.BuildStyles(e) }, e.sortData = function (t, i) { e.isSorting = !0, e.sortInfo({ column: t, direction: i }), e.clearSortingData(t), e.config.useExternalSorting ? e.config.sortInfo(e.sortInfo.peek()) : n.kg.sortService.Sort(e.sortInfo.peek(), e.sortedData), e.lastSortedColumn = t, e.isSorting = !1 }, e.clearSortingData = function (n) { n ? e.lastSortedColumn && n != e.lastSortedColumn && e.lastSortedColumn.sortDirection("") : $.each(e.columns(), function (n, t) { t.sortDirection("") }) }, e.fixColumnIndexes = function () { e.$$indexPhase = !0; var n = e.columns.peek(); $.each(n, function (n, t) { t.index = n }), e.$$indexPhase = !1 }, e.elementsNeedMeasuring = !0, e.columns = ko.observableArray([]), e.columns.subscribe(function (n) { e.config.columnsChanged(n) }), e.renderedRows = ko.observableArray([]), e.headerRow = null, e.rowHeight = e.config.rowHeight, e.jqueryUITheme = ko.observable(e.config.jqueryUITheme), e.footer = null, e.selectedItems = e.config.selectedItems, e.multiSelect = e.config.multiSelect, e.footerVisible = n.kg.utils.isNullOrUndefined(e.config.displayFooter) ? e.config.footerVisible : e.config.displayFooter, e.config.footerRowHeight = e.footerVisible ? e.config.footerRowHeight : 0, e.showColumnMenu = e.config.showColumnMenu, e.showMenu = ko.observable(!1), e.configGroups = ko.observableArray([]), e.enablePaging = e.config.enablePaging, e.pagingOptions = e.config.pagingOptions, e.rowTemplate = e.config.rowTemplate || n.kg.defaultRowTemplate(), e.headerRowTemplate = e.config.headerRowTemplate || n.kg.defaultHeaderRowTemplate(), e.topSummaryRowTemplate = e.config.topSummaryRowTemplate || n.kg.defaultTopSummaryRowTemplate(), e.aggregateRowTemplate = e.config.aggregateRowTemplate || (e.config.showAggregateSummary ? n.kg.aggregateSummaryTemplate() : n.kg.aggregateTemplate()), e.config.rowTemplate && !i.test(e.config.rowTemplate) && (e.rowTemplate = n.kg.utils.getTemplatePromise(e.config.rowTemplate)), e.config.headerRowTemplate && !i.test(e.config.headerRowTemplate) && (e.headerRowTemplate = n.kg.utils.getTemplatePromise(e.config.headerRowTemplate)), e.config.topSummaryRowTemplate && !i.test(e.config.topSummaryRowTemplate) && (e.topSummaryRowTemplate = n.kg.utils.getTemplatePromise(e.config.topSummaryRowTemplate)), e.config.aggregateRowTemplate && !i.test(e.config.aggregateRowTemplate) && (e.aggregateRowTemplate = n.kg.utils.getTemplatePromise(e.config.aggregateRowTemplate)), e.visibleColumns = ko.computed(function () { var n = e.columns(); return n.filter(function (n) { return n.visible() }) }), e.nonAggColumns = ko.computed(function () { return e.columns().filter(function (n) { return !n.isAggCol }) }), e.nonAggAndCheckboxVisibleColumns = ko.computed(function () { var n = e.nonAggColumns(); return n.filter(function (n) { var t = n.visible(); return t && n.field != "✔" }) }), e.aggregateRowColumns = ko.computed(function () { return e.nonAggAndCheckboxVisibleColumns().slice(1) }), e.anyAggregateRowColumn = ko.computed(function () { return e.nonAggAndCheckboxVisibleColumns().length > 0 }), e.firstRealColumnIndex = ko.computed(function () { return e.visibleColumns().length - e.nonAggAndCheckboxVisibleColumns().length }), e.toggleShowMenu = function () { e.showMenu(!e.showMenu()) }, e.allSelected = e.config.selectAllState, e.allSelected.subscribe(function (n) { e.config.beforeSelectionChange(e.sortedData.peek(), this) && (e.selectionService.toggleSelectAll(n), e.config.afterSelectionChange(e.selectedItems.peek(), this)) }), e.totalFilteredItemsLength = ko.computed(function () { return e.filteredData().length }), e.showGroupPanel = ko.computed(function () { return e.config.showGroupPanel }), e.showTopSummary = ko.computed(function () { return e.config.showTopSummary }), e.showAggregateSummary = ko.computed(function () { return e.config.showAggregateSummary }), e.topPanelHeight = ko.observable(e.config.showGroupPanel && e.config.showTopSummary ? e.config.headerRowHeight * 3 : e.config.showGroupPanel || e.config.showTopSummary ? e.config.headerRowHeight * 2 : e.config.headerRowHeight), e.viewportDimHeight = ko.computed(function () { return Math.max(0, e.rootDim.outerHeight() - e.topPanelHeight() - e.config.footerRowHeight - 2) }), e.groupBy = function (t) { var i = e.configGroups().indexOf(t); i == -1 ? (t.isGroupedBy(!0), e.configGroups.push(t), t.groupIndex(e.configGroups().length)) : e.removeGroup(i), n.kg.domUtilityService.BuildStyles(e) }, e.removeGroup = function (t) { var i = e.columns().filter(function (n) { return n.groupIndex() == t + 1 })[0]; i.isGroupedBy(!1), i.groupIndex(0), e.columns.splice(t, 1), e.configGroups.splice(t, 1), e.fixGroupIndexes(), e.configGroups().length === 0 && e.fixColumnIndexes(), n.kg.domUtilityService.BuildStyles(e) }, e.fixGroupIndexes = function () { $.each(e.configGroups(), function (n, t) { t.groupIndex(n + 1) }) }, e.totalRowWidth = function () { var n = 0, t = e.visibleColumns(); return $.each(t, function (t, i) { n += i.width }), n }, e.headerScrollerDim = function () { var i = e.viewportDimHeight(), r = e.maxCanvasHt(), u = r > i, t = new n.kg.Dimension; return t.autoFitHeight = !0, t.outerWidth = e.totalRowWidth(), u ? t.outerWidth += e.elementDims.scrollW : r - i <= e.elementDims.scrollH && (t.outerWidth += e.elementDims.scrollW), t }, e.jqueryUITheme = e.config.jqueryUITheme, e.maxRows = ko.observable(Math.max(e.config.pagingOptions.totalServerItems() || e.sortedData().length, 1)), e.maxRowsDisplay = ko.computed(function () { return e.maxRows() }), e.multiSelect = ko.observable(e.config.canSelectRows && e.config.multiSelect), e.selectedItemCount = ko.computed(function () { return e.selectedItems().length }), e.maxPages = ko.computed(function () { return e.maxRows(Math.max(e.config.pagingOptions.totalServerItems() || e.sortedData().length, 1)), Math.ceil(e.maxRows() / e.pagingOptions.pageSize()) }), e.pageForward = function () { var n = e.config.pagingOptions.currentPage(); e.config.pagingOptions.currentPage(Math.min(n + 1, e.maxPages())) }, e.pageBackward = function () { var n = e.config.pagingOptions.currentPage(); e.config.pagingOptions.currentPage(Math.max(n - 1, 1)) }, e.pageToFirst = function () { e.config.pagingOptions.currentPage(1) }, e.pageToLast = function () { var n = e.maxPages(); e.config.pagingOptions.currentPage(n) }, e.cantPageForward = ko.computed(function () { var n = e.config.pagingOptions.currentPage(), t = e.maxPages(); return !(n < t) }), e.cantPageBackward = ko.computed(function () { var n = e.config.pagingOptions.currentPage(); return !(n > 1) }), e.init() }, kg.Range = function (n, t) { this.topRow = n, this.bottomRow = t }, n.kg.Row = function (i, r, u) { var f = this; f.canSelectRows = r.canSelectRows, f.rowClasses = r.rowClasses, f.selectedItems = r.selectedItems, f.entity = i, f.selectionService = u, f.selected = ko.observable(!1), f.continueSelection = function (n) { f.selectionService.ChangeSelection(f, n) }, f.toggleSelected = function (n, t) { if (!f.canSelectRows) return !0; var i = t.target || t; return (i.type == "checkbox" && f.selected(!f.selected()), r.selectWithCheckboxOnly && i.type != "checkbox") ? !0 : f.beforeSelectionChange(f, t) ? (f.continueSelection(t), f.afterSelectionChange(f, t)) : !1 }, f.entity[t] === undefined ? f.entity[t] = !1 : f.selectionService.setSelection(f, f.entity[t]), f.rowIndex = ko.observable(0), f.offsetTop = ko.observable("0px"), f.rowDisplayIndex = 0, f.isEven = ko.computed(function () { return f.rowIndex() % 2 == 0 ? !0 : !1 }), f.isOdd = ko.computed(function () { return f.rowIndex() % 2 != 0 ? !0 : !1 }), f.beforeSelectionChange = r.beforeSelectionChangeCallback, f.afterSelectionChange = r.afterSelectionChangeCallback, f.propertyCache = {}, f.getProperty = function (t) { return f.propertyCache[t] || (f.propertyCache[t] = n.kg.utils.evalProperty(f.entity, t)) } }, n.kg.SearchProvider = function (n) { var t = this, i = [], r; t.extFilter = n.config.filterOptions.useExternalFilter, t.showFilter = n.config.showFilter, t.filterText = n.config.filterOptions.filterText, t.throttle = n.config.filterOptions.filterThrottle, t.fieldMap = {}, t.evalFilter = function () { i.length === 0 ? n.filteredData(n.sortedData.peek().filter(function (n) { return !n._destroy })) : n.filteredData(n.sortedData.peek().filter(function (n) { var u, s, r, f, e, o; if (n._destroy) return !1; for (u = 0, s = i.length; u < s; u++) { if (r = i[u], !r.column) { for (f in n) if (n.hasOwnProperty(f) && (e = ko.utils.unwrapObservable(n[f]), e && r.regex.test(e.toString()))) return !0; return !1 } if (o = ko.utils.unwrapObservable(n[r.column]) || ko.utils.unwrapObservable(n[t.fieldMap[r.columnDisplay]]), !o || !r.regex.test(o.toString())) return !1 } return !0 })), n.rowFactory.filteredDataChanged() }; var u = function (n, t) { try { return new RegExp(n, t) } catch (i) { return new RegExp(n.replace(/(\^|\$|\(|\)|\<|\>|\[|\]|\{|\}|\\|\||\.|\*|\+|\?)/g, "\\$1")) } }, f = function (n) { var t, r; (i = [], t = $.trim(n)) && (r = t.split(";"), $.each(r, function (n, t) { var r = t.split(":"), f, e, o; r.length > 1 ? (f = $.trim(r[0]), e = $.trim(r[1]), f && e && i.push({ column: f, columnDisplay: f.replace(/\s+/g, "").toLowerCase(), regex: u(e, "i") })) : (o = $.trim(r[0]), o && i.push({ column: "", regex: u(o, "i") })) })) }, e = ko.computed(function () { var n = t.filterText(); t.extFilter || n == r || (r = n, f(n), t.evalFilter()) }); typeof t.throttle == "number" && e.extend({ throttle: t.throttle }), t.extFilter || n.columns.subscribe(function (n) { $.each(n, function (n, i) { t.fieldMap[i.displayName().toLowerCase().replace(/\s+/g, "")] = i.field }) }) }, n.kg.SelectionService = function (n) { var i = this; i.multi = n.config.multiSelect, i.selectedItems = n.config.selectedItems, i.selectedIndex = n.config.selectedIndex, i.lastClickedRow = undefined, i.ignoreSelectedItemChanges = !1, i.rowFactory = {}, i.Initialize = function (n) { i.rowFactory = n }, i.ChangeSelection = function (r, u) { var o, f, e; if (n.$$selectionPhase = !0, u && u.shiftKey && i.multi) { if (i.lastClickedRow) { if (o = n.filteredData.indexOf(r.entity), f = n.filteredData.indexOf(i.lastClickedRow.entity), o == f) return !1; for (f++, o < f && (o = o ^ f, f = o ^ f, o = o ^ f), e = []; f <= o; f++) e.push(i.rowFactory.rowCache[f]); return e[e.length - 1].beforeSelectionChange(e, u) && ($.each(e, function (n, r) { r.selected(!0), r.entity[t] = !0, i.selectedItems.indexOf(r.entity) === -1 && i.selectedItems.push(r.entity) }), e[e.length - 1].afterSelectionChange(e, u)), i.lastClickedRow = e[e.length - 1], !0 } } else i.multi ? i.setSelection(r, !r.selected()) : (i.lastClickedRow && i.lastClickedRow != r && i.setSelection(i.lastClickedRow, !1), i.setSelection(r, n.config.keepLastSelected ? !0 : !r.selected())); return i.lastClickedRow = r, n.$$selectionPhase = !1, !0 }, i.setSelection = function (n, r) { if (n.selected(r), n.entity[t] = r, r) i.selectedItems.indexOf(n.entity) === -1 && i.selectedItems.push(n.entity); else { var u = i.selectedItems.indexOf(n.entity); u > 0 && i.selectedItems.splice(u, 1) } }, i.toggleSelectAll = function (r) { var u = i.selectedItems().length; u > 0 && i.selectedItems.splice(0, u), $.each(n.filteredData(), function (n, u) { u[t] = r, r && i.selectedItems.push(u) }), $.each(i.rowFactory.rowCache, function (n, t) { t && t.selected && t.selected(r) }) } }, n.kg.StyleProvider = function (t) { t.canvasStyle = ko.computed(function () { return { height: t.maxCanvasHt().toString() + "px" } }), t.headerScrollerStyle = ko.computed(function () { return { height: t.config.headerRowHeight + "px" } }), t.topPanelStyle = ko.computed(function () { return { width: t.rootDim.outerWidth() + "px", height: t.topPanelHeight() + "px" } }), t.headerStyle = ko.computed(function () { return { width: Math.max(0, t.rootDim.outerWidth() - n.kg.domUtilityService.ScrollW) + "px", height: t.config.headerRowHeight + "px" } }), t.topSummaryStyle = ko.computed(function () { return { width: Math.max(0, t.rootDim.outerWidth() - n.kg.domUtilityService.ScrollW) + "px", height: t.config.headerRowHeight + "px" } }), t.viewportStyle = ko.computed(function () { return { width: t.rootDim.outerWidth() + "px", height: t.viewportDimHeight() + "px" } }), t.footerStyle = ko.computed(function () { return { width: t.rootDim.outerWidth() + "px", height: t.config.footerRowHeight + "px", display: t.config.footerRowHeight > 0 ? "block" : "none" } }) }, n.kg.sortService = { colSortFnCache: {}, dateRE: /^(\d\d?)[\/\.-](\d\d?)[\/\.-]((\d\d)?\d\d)$/, guessSortFn: function (t) { var i, u, r, f, e; if (t === undefined || t === null || t === "") return null; u = typeof t; switch (u) { case "number": i = n.kg.sortService.sortNumber; break; case "boolean": i = n.kg.sortService.sortBool; break; default: i = undefined } return i ? i : Object.prototype.toString.call(t) === "[object Date]" ? n.kg.sortService.sortDate : u !== "string" ? n.kg.sortService.basicSort : t.match(/^-?[�$�]?[\d,.]+%?$/) ? n.kg.sortService.sortNumberStr : (r = t.match(n.kg.sortService.dateRE), r) ? (f = parseInt(r[1], 10), e = parseInt(r[2], 10), f > 12 ? n.kg.sortService.sortDDMMStr : e > 12 ? n.kg.sortService.sortMMDDStr : n.kg.sortService.sortMMDDStr) : n.kg.sortService.sortAlpha }, basicSort: function (n, t) { return n == t ? 0 : n < t ? -1 : 1 }, sortNumber: function (n, t) { return n - t }, sortNumberStr: function (n, t) { var i, r, u = !1, f = !1; return (i = parseFloat(n.replace(/[^0-9.-]/g, "")), isNaN(i) && (u = !0), r = parseFloat(t.replace(/[^0-9.-]/g, "")), isNaN(r) && (f = !0), u && f) ? 0 : u ? 1 : f ? -1 : i - r }, sortAlpha: function (n, t) { var i = n.toLowerCase(), r = t.toLowerCase(); return i == r ? 0 : i < r ? -1 : 1 }, sortBool: function (n, t) { return n && t ? 0 : n || t ? n ? 1 : -1 : 0 }, sortDate: function (n, t) { var i = n.getTime(), r = t.getTime(); return i == r ? 0 : i < r ? -1 : 1 }, sortDDMMStr: function (t, i) { var o, s, f, r, u, e; return (f = t.match(n.kg.sortService.dateRE), e = f[3], r = f[2], u = f[1], r.length == 1 && (r = "0" + r), u.length == 1 && (u = "0" + u), o = e + r + u, f = i.match(n.kg.sortService.dateRE), e = f[3], r = f[2], u = f[1], r.length == 1 && (r = "0" + r), u.length == 1 && (u = "0" + u), s = e + r + u, o == s) ? 0 : o < s ? -1 : 1 }, sortMMDDStr: function (t, i) { var o, s, f, r, u, e; return (f = t.match(n.kg.sortService.dateRE), e = f[3], u = f[2], r = f[1], r.length == 1 && (r = "0" + r), u.length == 1 && (u = "0" + u), o = e + r + u, f = i.match(dateRE), e = f[3], u = f[2], r = f[1], r.length == 1 && (r = "0" + r), u.length == 1 && (u = "0" + u), s = e + r + u, o == s) ? 0 : o < s ? -1 : 1 }, sortData: function (t, i) { var e = t(), r, s, u, o; if (e && i) { if (r = i.column, s = i.direction, n.kg.sortService.colSortFnCache[r.field]) u = n.kg.sortService.colSortFnCache[r.field]; else if (r.sortingAlgorithm != undefined) u = r.sortingAlgorithm, n.kg.sortService.colSortFnCache[r.field] = r.sortingAlgorithm; else { if (o = e[0], !o) return; u = kg.sortService.guessSortFn(o[r.field]), u ? n.kg.sortService.colSortFnCache[r.field] = u : u = n.kg.sortService.sortAlpha } e.sort(function (t, i) { var e = n.kg.utils.evalProperty(t, r.field), o = n.kg.utils.evalProperty(i, r.field); if (o || e) if (e) { if (!o) return -1 } else return 1; else return 0; return s === f ? u(e, o) : 0 - u(e, o) }), t(e); return } }, Sort: function (t, i) { n.kg.sortService.isSorting || (n.kg.sortService.isSorting = !0, n.kg.sortService.sortData(i, t), n.kg.sortService.isSorting = !1) } }, l = function () { var t = $("<div><\/div>"); t.appendTo("body"), t.height(100).width(100).css("position", "absolute").css("overflow", "scroll"), t.append('<div style="height: 400px; width: 400px;"><\/div>'), n.kg.domUtilityService.ScrollH = t.height() - t[0].clientHeight, n.kg.domUtilityService.ScrollW = t.width() - t[0].clientWidth, t.empty(), t.attr("style", ""), t.append('<span style="font-family: Verdana, Helvetica, Sans-Serif; font-size: 14px;"><strong>M<\/strong><\/span>'), n.kg.domUtilityService.LetterW = t.children().first().width(), t.remove() }, n.kg.domUtilityService = { AssignGridContainers: function (t, i) { i.$root = $(t), i.$topPanel = i.$root.find(".kgTopPanel"), i.$groupPanel = i.$root.find(".kgGroupPanel"), i.$headerContainer = i.$topPanel.find(".kgHeaderContainer"), i.$topSummaryContainer = i.$topPanel.find(".kgTopSummaryContainer"), i.$headerScroller = i.$topPanel.find(".kgHeaderScroller"), i.$headers = i.$headerScroller.children(), i.$viewport = i.$root.find(".kgViewport"), i.$canvas = i.$viewport.find(".kgCanvas"), i.$footerPanel = i.$root.find(".ngFooterPanel"), n.kg.domUtilityService.UpdateGridLayout(i) }, UpdateGridLayout: function (n) { var t = n.$viewport.scrollTop(); n.elementDims.rootMaxW = n.$root.width(), n.elementDims.rootMaxH = n.$root.height(), n.refreshDomSizes(), n.adjustScrollTop(t, !0) }, BuildStyles: function (t) { var h = t.config.rowHeight, r = t.$styleSheet, i = t.gridId, f, l = t.visibleColumns(), o = 0, u, s, c, e; if (r || (r = $("#" + i), r[0] || (r = $("<style id='" + i + "' type='text/css' rel='stylesheet' />"), r.appendTo("body"))), r.empty(), u = t.totalRowWidth(), f = "." + i + " .kgCanvas { width: " + u + "px; }." + i + " .kgRow { width: " + u + "px; }." + i + " .kgCell { height: " + h + "px; }." + i + " .kgCanvas { width: " + u + "px; }." + i + " .kgHeaderCell { top: 0; bottom: 0; }." + i + " .kgHeaderScroller { width: " + (u + n.kg.domUtilityService.scrollH + 2) + "px}", $.each(l, function (n, t) { f += "." + i + " .col" + n + " { width: " + t.width + "px; left: " + o + "px; right: " + (u - o - t.width) + "px; height: " + h + "px }." + i + " .colt" + n + " { width: " + t.width + "px; }", o += t.width }), t.config.showAggregateSummary) for (s = t.visibleColumns().length - t.nonAggAndCheckboxVisibleColumns().length, c = t.nonAggAndCheckboxVisibleColumns()[0], e = 0; e < s; e++) f += "." + i + " .aggTitleCol" + e + " {width: " + (c.width + (s - e - 1) * 25) + "px;}"; n.kg.utils.isIe ? r[0].styleSheet.cssText = f : r.append(document.createTextNode(f)), t.$styleSheet = r }, ScrollH: 17, ScrollW: 17, LetterW: 10 }, l() })(window);